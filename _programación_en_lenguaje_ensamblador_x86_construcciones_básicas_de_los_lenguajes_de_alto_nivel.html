<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<meta name="keywords" content="computer, architecture">
<meta name="author" content="Cándido Aramburu">
<title>Estructura de Computadores  (240306)</title>
<style>
@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";
@import "https://cdn.jsdelivr.net/gh/asciidoctor/asciidoctor@2.0/data/stylesheets/asciidoctor-default.css";



h1, h2, h3, h4, h5, h6, #toctitle,
.sidebarblock > .content > .title {
  color: rgba(221, 72, 20, 0.8);
}



</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge .cm {
  color: #999988;
  font-style: italic;
}
pre.rouge .cp {
  color: #999999;
  font-weight: bold;
}
pre.rouge .c1 {
  color: #999988;
  font-style: italic;
}
pre.rouge .cs {
  color: #999999;
  font-weight: bold;
  font-style: italic;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cpf {
  color: #999988;
  font-style: italic;
}
pre.rouge .err {
  color: #a61717;
  background-color: #e3d2d2;
}
pre.rouge .gd {
  color: #000000;
  background-color: #ffdddd;
}
pre.rouge .ge {
  color: #000000;
  font-style: italic;
}
pre.rouge .gr {
  color: #aa0000;
}
pre.rouge .gh {
  color: #999999;
}
pre.rouge .gi {
  color: #000000;
  background-color: #ddffdd;
}
pre.rouge .go {
  color: #888888;
}
pre.rouge .gp {
  color: #555555;
}
pre.rouge .gs {
  font-weight: bold;
}
pre.rouge .gu {
  color: #aaaaaa;
}
pre.rouge .gt {
  color: #aa0000;
}
pre.rouge .kc {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kd {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kn {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kp {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kr {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kt {
  color: #445588;
  font-weight: bold;
}
pre.rouge .k, pre.rouge .kv {
  color: #000000;
  font-weight: bold;
}
pre.rouge .mf {
  color: #009999;
}
pre.rouge .mh {
  color: #009999;
}
pre.rouge .il {
  color: #009999;
}
pre.rouge .mi {
  color: #009999;
}
pre.rouge .mo {
  color: #009999;
}
pre.rouge .m, pre.rouge .mb, pre.rouge .mx {
  color: #009999;
}
pre.rouge .sa {
  color: #000000;
  font-weight: bold;
}
pre.rouge .sb {
  color: #d14;
}
pre.rouge .sc {
  color: #d14;
}
pre.rouge .sd {
  color: #d14;
}
pre.rouge .s2 {
  color: #d14;
}
pre.rouge .se {
  color: #d14;
}
pre.rouge .sh {
  color: #d14;
}
pre.rouge .si {
  color: #d14;
}
pre.rouge .sx {
  color: #d14;
}
pre.rouge .sr {
  color: #009926;
}
pre.rouge .s1 {
  color: #d14;
}
pre.rouge .ss {
  color: #990073;
}
pre.rouge .s, pre.rouge .dl {
  color: #d14;
}
pre.rouge .na {
  color: #008080;
}
pre.rouge .bp {
  color: #999999;
}
pre.rouge .nb {
  color: #0086B3;
}
pre.rouge .nc {
  color: #445588;
  font-weight: bold;
}
pre.rouge .no {
  color: #008080;
}
pre.rouge .nd {
  color: #3c5d5d;
  font-weight: bold;
}
pre.rouge .ni {
  color: #800080;
}
pre.rouge .ne {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nf, pre.rouge .fm {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nl {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nn {
  color: #555555;
}
pre.rouge .nt {
  color: #000080;
}
pre.rouge .vc {
  color: #008080;
}
pre.rouge .vg {
  color: #008080;
}
pre.rouge .vi {
  color: #008080;
}
pre.rouge .nv, pre.rouge .vm {
  color: #008080;
}
pre.rouge .ow {
  color: #000000;
  font-weight: bold;
}
pre.rouge .o {
  color: #000000;
  font-weight: bold;
}
pre.rouge .w {
  color: #bbbbbb;
}
pre.rouge {
  background-color: #f8f8f8;
}
</style>
<!-- Change some CSS.
<style>
.imageblock{
  &.text-center > .title {
    text-align: center !important;
  }
}
</style>

-->

<style type="text/css"> .imageblock > .title { text-align: center; } </style>

<style>.toc-current{font-weight: bold;} .toc-root{font-family: "Open Sans","DejaVu Sans",sans-serif;
                       font-size: 0.9em;} #content{display: flex; flex-direction: column; flex: 1 1 auto;}
             .nav-footer{text-align: center; margin-top: auto;}
             .nav-footer > p > a {white-space: nowrap;}</style>
</head>
<body id="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel" class="book">
<div id="header">
<h1>Estructura de Computadores  (240306)</h1>
<div class="details">
<span id="author" class="author">Cándido Aramburu</span><br>
<span id="email" class="email"><a href="mailto:candido@unavarra.es">candido@unavarra.es</a></span><br>
<span id="revdate">2022-10-20</span>
</div>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<p><span class="toc-root"><a href="eecc_book.html">Estructura de Computadores  (240306)</a></span></p><ul class="sectlevel0">
<li><a href="_i_arquitectura_del_repertorio_de_instrucciones_isa_computadora_von_neumann_datos_instrucciones_programación.html">I Arquitectura del Repertorio de Instrucciones (ISA): computadora von Neumann, datos, instrucciones, programación.</a>
<ul class="sectlevel1">
<li><a href="_introducción_a_la_estructura_de_los_computadores.html">1. Introducción a la Estructura de los Computadores</a>
</li>
<li><a href="_arquitectura_von_neumann.html">2. Arquitectura Von Neumann</a>
</li>
<li><a href="_representación_de_los_datos.html">3. Representación de los Datos</a>
</li>
<li><a href="_operaciones_aritmeticas_y_logicas.html">4. Operaciones Aritmeticas y Logicas</a>
</li>
<li><a href="_representación_de_las_instrucciones.html">5. Representación de las Instrucciones</a>
</li>
<li><a href="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel.html"><span class="toc-current">6. Programación en Lenguaje Ensamblador (x86): Construcciones básicas de los lenguajes de alto nivel.</span></a>
<ul class="sectlevel2">
<li><a href="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel.html#_temario_6">6.1. Temario</a>
</li>
<li><a href="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel.html#_introducción_2">6.2. Introducción</a>
<ul class="sectlevel3">
<li><a href="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel.html#_objetivos_2">6.2.1. Objetivos</a>
</li>
<li><a href="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel.html#_requisitos_2">6.2.2. Requisitos</a>
</li>
<li><a href="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel.html#_referencias">6.2.3. Referencias</a>
</li>
</ul>
</li>
<li><a href="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel.html#_estructura_de_la_computadora_con_arquitectura_intel_x86_64">6.3. Estructura de la  Computadora con Arquitectura Intel x86-64</a>
<ul class="sectlevel3">
<li><a href="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel.html#_manuales_intel_isa_x86">6.3.1. Manuales Intel ISA x86</a>
</li>
<li><a href="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel.html#_intro">6.3.2. Intro</a>
</li>
<li><a href="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel.html#_cpu_memoria">6.3.3. CPU-Memoria</a>
</li>
<li><a href="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel.html#_registros_internos_a_la_cpu_x86">6.3.4. Registros internos a la CPU x86</a>
</li>
</ul>
</li>
<li><a href="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel.html#_representación_de_los_datos_en_lenguaje_ensamblador_asm_para_la_arquitectura_i386amd64">6.4. Representación de los datos en lenguaje ensamblador (ASM) para la arquitectura i386/amd64</a>
<ul class="sectlevel3">
<li><a href="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel.html#_tipos_de_datos">6.4.1. Tipos de Datos</a>
</li>
<li><a href="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel.html#_tamaño_del_operando_x86">6.4.2. Tamaño del operando x86</a>
</li>
<li><a href="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel.html#_alineamiento_de_bytes_big_little_endian">6.4.3. Alineamiento de Bytes: Big-Little Endian</a>
</li>
<li><a href="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel.html#_ejemplo">6.4.4. Ejemplo</a>
</li>
</ul>
</li>
<li><a href="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel.html#repertorio_instruc_oper">6.5. Repertorio de Instrucciones en lenguaje ensamblador (ASM) para la arquitectura i386/amd64: Operaciones</a>
<ul class="sectlevel3">
<li><a href="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel.html#_ejemplo_2">6.5.1. Ejemplo</a>
</li>
<li><a href="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel.html#_manual_rápido">6.5.2. Manual rápido</a>
</li>
<li><a href="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel.html#_manuales_y_tablas">6.5.3. Manuales y Tablas</a>
</li>
<li><a href="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel.html#_tipo_de_descripción_de_códigos_de_operación_en_el_manual_de_intel">6.5.4. Tipo de descripción de Códigos de Operación en el Manual de Intel</a>
</li>
</ul>
</li>
<li><a href="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel.html#mnemonicos_basicos_explicados">6.6. Mnemónicos Básicos (Explicados)</a>
<ul class="sectlevel3">
<li><a href="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel.html#_operaciones_aritméticas">6.6.1. Operaciones aritméticas</a>
</li>
<li><a href="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel.html#_extensión_del_signo">6.6.2. Extensión del signo</a>
</li>
<li><a href="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel.html#_cambio_de_tamaño">6.6.3. Cambio de tamaño</a>
</li>
<li><a href="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel.html#_operaciones_booleanas">6.6.4. Operaciones Booleanas</a>
</li>
<li><a href="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel.html#prog_condicional">6.6.5. Procesamiento Condicional: CMP,TEST,SETcc</a>
</li>
<li><a href="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel.html#_saltos">6.6.6. Saltos</a>
</li>
<li><a href="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel.html#_desplazamiento_y_rotación">6.6.7. Desplazamiento y rotación</a>
</li>
<li><a href="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel.html#_cambiar_el_endianess">6.6.8. Cambiar el Endianess</a>
</li>
</ul>
</li>
<li><a href="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel.html#_formato_de_instrucción_isa_intel_x86_64">6.7. Formato de Instrucción: ISA Intel x86-64</a>
</li>
<li><a href="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel.html#_subrutinas">6.8. Subrutinas</a>
<ul class="sectlevel3">
<li><a href="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel.html#_referencias_2">6.8.1. Referencias</a>
</li>
<li><a href="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel.html#_introducción_4">6.8.2. Introducción</a>
</li>
<li><a href="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel.html#_lenguaje_c_sentencia_función">6.8.3. Lenguaje C: Sentencia Función</a>
</li>
<li><a href="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel.html#_anidamiento_de_funciones">6.8.4. Anidamiento de Funciones</a>
</li>
<li><a href="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel.html#_pilaframe">6.8.5. Pila/Frame</a>
</li>
<li><a href="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel.html#_argumentos_de_la_subrutina">6.8.6. Argumentos de la subrutina</a>
</li>
<li><a href="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel.html#_llamada_a_la_subrutina">6.8.7. Llamada a la subrutina</a>
</li>
<li><a href="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel.html#_definición_de_la_subrutina">6.8.8. Definición de la subrutina</a>
</li>
<li><a href="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel.html#_registros_a_preservar">6.8.9. Registros a Preservar</a>
</li>
<li><a href="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel.html#_retorno_de_la_subrutina">6.8.10. Retorno de la subrutina</a>
</li>
<li><a href="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel.html#_estado_de_la_pila">6.8.11. Estado de la pila</a>
</li>
<li><a href="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel.html#_ejercicios_de_programación_práctica">6.8.12. Ejercicios de programación práctica</a>
</li>
</ul>
</li>
<li><a href="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel.html#_llamadas_al_sistema_operativo">6.9. Llamadas al Sistema Operativo</a>
<ul class="sectlevel3">
<li><a href="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel.html#_introducción_6">6.9.1. Introducción</a>
</li>
<li><a href="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel.html#_arquitectura_amd64_2">6.9.2. Arquitectura amd64</a>
</li>
<li><a href="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel.html#_arquitectura_i386">6.9.3. Arquitectura i386</a>
</li>
<li><a href="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel.html#_códigos_de_llamada_2">6.9.4. Códigos de llamada</a>
</li>
<li><a href="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel.html#_ejemplo_3">6.9.5. Ejemplo</a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="_ii_unidades_básicas_procesador_central_unidad_de_memoria_mecanismos_entradasalida.html">II Unidades Básicas: Procesador Central, Unidad de Memoria, Mecanismos Entrada/Salida.</a>
</li>
<li><a href="_iii_ejercicios_de_teoría.html">III Ejercicios de Teoría</a>
</li>
<li><a href="_iv_autoevaluación_teoría.html">IV Autoevaluación Teoría</a>
</li>
<li><a href="_v_guiones_de_prácticas_programación_ensamblador_x86.html">V Guiones de Prácticas: Programación Ensamblador x86</a>
</li>
<li><a href="_vi_hojas_de_referencia_rápida.html">VI Hojas de Referencia Rápida</a>
</li>
<li><a href="_vii_autoevaluación_prácticas.html">VII Autoevaluación Prácticas</a>
</li>
<li><a href="_viii_apéndices.html">VIII Apéndices</a>
</li>
<li><a href="_ix_bibliografía.html">IX Bibliografía</a>
</li>
<li><a href="_x_glosario.html">X Glosario</a>
</li>
<li><a href="_xi_colofón.html">XI Colofón</a>
</li>
<li><a href="_index.html">Index</a>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel">6. Programación en Lenguaje Ensamblador (x86): Construcciones básicas de los lenguajes de alto nivel.</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_temario_6">6.1. Temario</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Programación en lenguaje Ensamblador x86</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>x86 :Representación de Datos, Representación de Instrucciones, Modos de direccionamiento.</p>
</li>
<li>
<p>Sentencias de asignación</p>
</li>
<li>
<p>Sentencias condicionales</p>
</li>
<li>
<p>Bucles</p>
</li>
<li>
<p>LLamadas y retorno de funcion o subrutina</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_introducción_2">6.2. Introducción</h3>
<div class="sect3">
<h4 id="_objetivos_2">6.2.1. Objetivos</h4>
<div class="ulist">
<ul>
<li>
<p>Analizar la arquitectura del repertorio de las instrucciones máquina (Formato de instrucciones, formato de datos, operaciones y direccionamiento de operandos) de la arquitectura x86-64 para su utilización en el desarrollo práctico de programas en lenguaje ensamblador Gnu_AS(gas).</p>
</li>
<li>
<p>Capacidad para desarrollar pequeños programas en lenguaje ensamblador para la arquitectura x86 (32 bits) tanto en papel impreso como en un entorno de desarrollo computacional bien en el ordenador personal y también en las estaciones de trabajo del Laboratorio de Informática.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_requisitos_2">6.2.2. Requisitos</h4>
<div class="ulist">
<ul>
<li>
<p>Requisitos:</p>
<div class="ulist">
<ul>
<li>
<p>Von Neumann Architecture: Arquitectura de una Computadora, Máquina IAS.</p>
</li>
<li>
<p>Programación en lenguaje ensamblador IAS</p>
</li>
<li>
<p>Representacion de datos</p>
</li>
<li>
<p>Operaciones Aritméticas y Lógicas</p>
</li>
<li>
<p>Representación de las Instrucciones</p>
<div class="ulist">
<ul>
<li>
<p><a href="_representación_de_las_instrucciones.html#gas_sintax_direcci">Sintaxis y Direccionamiento ASM x86</a>: Sintaxis de las instrucciones en lenguaje ensamblador GnuAS y modos de direccionamiento para la arquitectura x86.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_referencias">6.2.3. Referencias</h4>
<div class="ulist">
<ul>
<li>
<p>Manual Assembler as: <a href="_toolchain_cadena_de_herramientas_en_el_proceso_de_compilación.html#toolchain">Apéndice: Cadena de herramientas Toolchain "as i386"</a></p>
</li>
<li>
<p><strong>Leerse</strong> los ocho primeros apartados del manual "Assembler as": <a href="_lenguajes_de_programación_en_ensamblador.html#assembler_as_i386">Apéndice: Características "as i386"</a></p>
</li>
<li>
<p>Manual Assembler as: <a href="_lenguajes_de_programación_en_ensamblador.html#assembler_as_directivas_i386">Apéndice: Directivas "as i386"</a></p>
</li>
<li>
<p>Referencias a manuales en el <a href="_lenguajes_de_programación_en_ensamblador.html#leng_asm">Apéndice</a></p>
</li>
<li>
<p>Bibliografía: <a href="_ix_bibliografía.html#prog_ensamblador">Programación Ensamblador</a>.</p>
</li>
<li>
<p>Apuntes completos <a href="_ix_bibliografía.html#WikiBook">WikiBook</a> de programación en lenguaje AT&amp;T con diversidad de aspectos.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_estructura_de_la_computadora_con_arquitectura_intel_x86_64">6.3. Estructura de la  Computadora con Arquitectura Intel x86-64</h3>
<div class="sect3">
<h4 id="_manuales_intel_isa_x86">6.3.1. Manuales Intel ISA x86</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.intel.es/content/www/es/es/architecture-and-technology/64-ia-32-architectures-software-developer-vol-1-manual.html" class="bare">https://www.intel.es/content/www/es/es/architecture-and-technology/64-ia-32-architectures-software-developer-vol-1-manual.html</a></p>
</li>
<li>
<p>8 Volúmenes: 1,2A,2B,2C,3A,3B,3C,3D</p>
<div class="ulist">
<ul>
<li>
<p>Volume 1: Basic Architecture</p>
</li>
<li>
<p>Volumes 2A, 2B and 2C: Instruction Set Reference</p>
</li>
<li>
<p>Volumes 3A, 3B, 3C and 3D: System Programming Guide</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_intro">6.3.2. Intro</h4>
<div class="ulist">
<ul>
<li>
<p>Para poder programar en lenguaje ensamblador GAS x86 eficazmente es necesario tener las nociones básicas de la ISA x86.</p>
</li>
<li>
<p>Se va analizar la arquitectura amd64 de 64 bits que abarca también a la arquitectura i386 de 32 bits.</p>
</li>
<li>
<p>Las empresas Intel y AMD comparten dichas arquitecturas cuyo  mercado abarca tanto ordenadores de sobremesa como servidores.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_cpu_memoria">6.3.3. CPU-Memoria</h4>
<div class="ulist">
<ul>
<li>
<p>Ver la estructura general de una computadora en el <a href="_arquitectura_de_una_computadora.html#estr_comp">Apéndice</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_registros_internos_a_la_cpu_x86">6.3.4. Registros internos a la CPU x86</h4>
<div class="sect4">
<h5 id="_introducción_3">introducción</h5>
<div class="ulist">
<ul>
<li>
<p>Registos NO accesibles por el programador en la arquitectura amd64</p>
<div class="ulist">
<ul>
<li>
<p>PC: Contador del Programa : x86 lo denomina RIP: 64 bits</p>
</li>
<li>
<p>IR: Registro de instrucción : 64 bits</p>
</li>
<li>
<p>MBR: Registro buffer de Memoria : 64 bits &#8594; WORD SIZE : 64</p>
</li>
<li>
<p>MAR: Registro de direcciones de Memoria: 40 bits</p>
<div class="ulist">
<ul>
<li>
<p>Capacidad de Memoria: 2<sup>40</sup> : 1TB</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Para el caso de la arquitectura i386 sustituir 64 bits por 32 bits y el registro MAR también es de 32 bits.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_registros_visibles_al_programador">Registros visibles al programador</h5>
<table class="tableblock frame-all grid-all" style="width: 50%;">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>63-0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31-0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>15-0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>15-8</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7-0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rax</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>eax</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ax</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ah</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>al</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rbx</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ebx</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bx</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bh</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bl</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rcx</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ecx</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cx</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ch</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cl</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rdx</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>edx</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dx</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dh</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dl</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rsi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>esi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>si</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sil</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rdi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>edi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>di</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dil</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rbp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ebp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bp</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bpl</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rsp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>esp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sp</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spl</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>r8</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>r8d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>r8w</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>r8b</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>r9</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>r9d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>r9w</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>r9b</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>r10</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>r10d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>r10w</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>r10b</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>r11</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>r11d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>r11w</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>r11b</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>r12</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>r12d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>r12w</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>r12b</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>r13</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>r13d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>r13w</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>r13b</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>r14</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>r14d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>r14w</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>r14b</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>r15</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>r15d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>r15w</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>r15b</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_compatibilidad_32_64">Compatibilidad 32-64</h5>
<div class="ulist">
<ul>
<li>
<p>En la nominación de los registros de la arquitectura de 64 bits sustituir R  por E y obtenemos la nominación de la arquitectura de 32 bits.</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all" style="width: 50%;">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">64 bits</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 bits</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RIP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EIP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EAX</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RFLAG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EFLAG</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;&#8230;&#8203;.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;&#8230;&#8203;&#8230;&#8203;&#8230;&#8203;.</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>Hay excepciones</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="CFR">Control Flag Register</h5>
<div class="ulist">
<ul>
<li>
<p>Registro de STATUS: La ejecución de una instrucción, activa unos bits denominados banderines que indican consecuencias de la operación realizada. Ejemplo: banderín de overflow : indica que la operación aritmética realizada ha resultado en un desbordamiento del resultado de dicha operación.</p>
</li>
<li>
<p><a href="http://en.wikipedia.org/wiki/FLAGS_register_(computing)">wikipedia</a></p>
</li>
<li>
<p>Unicamente nos fijamos en los flags OSZAPC.</p>
<table class="tableblock frame-all grid-all" style="width: 50%;">
<caption class="title">Table 11. RFLAG Register</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Flag</th>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-left valign-top">Name</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CF</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Carry flag</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PF</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parity flag</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AF</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adjust flag</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZF</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zero flag</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SF</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sign flag</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OF</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Overflow flag</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Carry flag:</p>
<div class="ulist">
<ul>
<li>
<p>se activa si la llevada afecta a una posición de bit mayor que del ancho de palabra (word size) de la ALU en una operación aritmética de números enteros sin signo o con signo</p>
</li>
</ul>
</div>
</li>
<li>
<p>Overflow flag:</p>
<div class="ulist">
<ul>
<li>
<p>se activa si teniendo en cuenta el bit de mayor peso MSB (aunque esté fuera el word size) indicase error en la operación aritmética con números enteros con signo. Si no se tiene en cuenta el MSB fuera del word size, la operación es correcta.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Parity Even flag:</p>
<div class="ulist">
<ul>
<li>
<p>indica si el número de bits del byte LSB del resultado de la última operación ha sido par.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Sign flag:</p>
<div class="ulist">
<ul>
<li>
<p>se activa si el resultado de la última operación ha sido negativo.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Adjust flag:</p>
<div class="ulist">
<ul>
<li>
<p>se activa si hay llevada en el nibble LSB del resultado de la última operación</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_casos_de_overflow">Casos de Overflow</h5>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Ejemplos de errores matemáticos por overflow: <a href="_operaciones_aritmeticas_y_logicas.html#of_cf_unsigned_signed">activación de los flags CF y OF</a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_otros_registros_internos_a_la_cpu_x86">Otros Registros internos a la CPU x86</h5>
<div class="imageblock">
<div class="content">
<img src="./images/instrucciones_representacion/registers_1200x800.png" alt="registers 1200x800">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Segment Registers: CS,DS,ES,FS,GS,SS</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://en.wikipedia.org/wiki/X86_memory_segmentation" class="bare">https://en.wikipedia.org/wiki/X86_memory_segmentation</a></p>
</li>
<li>
<p>Normalmente se utilizan de forma implicita: las instrucciones están en el segmento de código en direcciones relativas al registro CS, los datos están el segment data en direcciones relativas al registro DS, la pila están el segmento stack en direcciones relativas al registro SS.</p>
</li>
<li>
<p>utilización explícita:</p>
<div class="ulist">
<ul>
<li>
<p><code>movl $42, %fs:(%eax)  ; M[fs:eax]&#8592;42) ; eax contiene la dirección relativa a la dirección FS</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>El Sistema Operativo utiliza los registros segmento en la gestión de memoria virtual mediante los mecanismos de paginación y segmentación: <a href="https://nixhacker.com/segmentation-in-intel-64-bit/" class="bare">https://nixhacker.com/segmentation-in-intel-64-bit/</a> : La gestión de la memoria es un tema de la segunda parte de la asignatura.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Los registros fp, mmx y xmm se utilizan para ejecutar instrucciones complejas como la tangente que operan con números reales en coma flotante o instrucciones que ejecutan operaciones sobre múltiples datos enteros (Single Instruction Multiple Data) (P.ej producto escalar).</p>
</li>
<li>
<p>Más información en el <a href="_fpu_x87.html#fpu_x87">apéndice FPU_x87</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_representación_de_los_datos_en_lenguaje_ensamblador_asm_para_la_arquitectura_i386amd64">6.4. Representación de los datos en lenguaje ensamblador (ASM) para la arquitectura i386/amd64</h3>
<div class="sect3">
<h4 id="_tipos_de_datos">6.4.1. Tipos de Datos</h4>
<div class="sect4">
<h5 id="_números_y_caracteres">Números y Caracteres</h5>
<div class="ulist">
<ul>
<li>
<p>Número sin signo (naturales): codificación binario natural</p>
</li>
<li>
<p>Números enteros con signo: entero codificados en <strong>complemento a 2</strong></p>
</li>
<li>
<p>Números reales reales codificados en formato <strong>IEEE-754</strong> de simple o doble precisión</p>
</li>
<li>
<p>Caracteres alfanuméricos: código <strong>ASCII</strong></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_directivas_de_la_sección_de_datos">Directivas de la Sección de Datos</h5>
<div class="ulist">
<ul>
<li>
<p>Referencia <a href="_lenguajes_de_programación_en_ensamblador.html#assembler_as_directivas_i386">Apéndice</a></p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 12. Directivas básicas</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Directivas</th>
<th class="tableblock halign-left valign-top">descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.global o .globl etiqueta</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">variables globales</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.section .data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sección de las variables locales estáticas inicializadas</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.section .text</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sección de las instrucciones</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.section .bss</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sección de las variables sin inicializar</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.section .rodata</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sección de las variables de sólo lectura</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.type	  name , type description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tipo de variable, p.ej @function</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.common   100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserva 100 bytes sin inicializar y puede ser referenciado globalmente</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.lcomm   bucle, 100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserva 100bytes referenciados con el símbolo local bucle. Sin inicializar.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.space    100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserva 100 bytes inicializados a cero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.space    100, 3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserva 100 bytes inicializados a 3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.string  "Hola"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">añade el byte 0 al final de la cadena</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.asciz   "Hola"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">añade el byte 0 al final de la cadena</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.ascii   "Hola"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no añade le caracter NULL de final de cadena</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.byte    3,7,-10,0b1010,0xFF,0777</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tamaño 1Byte y formatos decimal,decimal,decimal,binario,hexadecimal,octal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.2byte    3,7,-10,0b1010,0xFF,0777</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tamaño 2Bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.word    3,7,-10,0b1010,0xFF,0777</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tamaño 2Bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.short   3,7,-10,0b1010,0xFF,0777</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tamaño 2B</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.4byte    3,7,-10,0b1010,0xFF,0777</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tamaño 4B</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.long    3,7,-10,0b1010,0xFF,0777</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tamaño 4B</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.int     3,7,-10,0b1010,0xFF,0777</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tamaño 4B</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.8byte    3,7,-10,0b1010,0xFF,0777</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tamaño 8B</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.quad    3,7,-10,0b1010,0xFF,0777</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tamaño 8B</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.octa    3,7,-10,0b1010,0xFF,0777</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">formato octal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.double  3.14159, 2 E-6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">precisión doble</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.float   2E-6, 3.14159</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">precisión simple</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.single  2E-6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">precisión simple</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.include "file"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">incluye el fichero . Obligatorias las comillas.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.equ     SUCCESS, 0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">macro que asocia el símbolo SUCCESS al número 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.macro macname macargs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">define el comienzo de una macro de nombre macname y argumentos macargs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.endmacro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">define el final de una macro</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.align   n</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">las instrucciones o datos posteriores empezarán en una dirección multiplo de n bytes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.end</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fin del ensamblaje</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>Et: Etiqueta</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_tamaño_del_operando_x86">6.4.2. Tamaño del operando x86</h4>
<div class="ulist">
<ul>
<li>
<p>Tamaño del operando: sufijos de los MNEMÓNICOS.</p>
<div class="listingblock">
<div class="content">
<pre>q (quad) 8bytes
l (long) 4bytes
w (word) 2bytes
b (byte) 1byte</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Ejemplos:</p>
<div class="ulist">
<ul>
<li>
<p>movq  %rax,resultado</p>
</li>
<li>
<p>movl  %eax,resultado</p>
</li>
<li>
<p>movw  %ax,resultado</p>
</li>
<li>
<p>movb  %ah,resultado</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_alineamiento_de_bytes_big_little_endian">6.4.3. Alineamiento de Bytes: Big-Little Endian</h4>
<div class="ulist">
<ul>
<li>
<p>Los bytes de un dato de varios bytes se pueden almacenar en memoria en sentido MSB-<em><em>_- LSB ó MSB-</em>_</em>-LSB</p>
</li>
<li>
<p>Alineamiento <em>Little Endian</em>: El byte de menor peso LSB se almacena en la posición de memoria más baja</p>
</li>
<li>
<p>Ejemplo <strong>0x40000: 00 AF BF CF</strong></p>
<div class="ulist">
<ul>
<li>
<p>En la posición de memoria principal 0x40000 está almacenado el dato de 4 bytes: <code>00 AF BF CF</code></p>
<div class="ulist">
<ul>
<li>
<p>Los bytes se guardan en dirección de memoria ascendente. Cuando se escribe en horizontal, ascendente significa de izda a dcha.</p>
</li>
<li>
<p>En la posición <strong>0x40000</strong> está el byte 00 &#8594; <strong>LSB</strong> (Least Significant Byte)</p>
</li>
<li>
<p>En la posición <strong>0x40001</strong> está el byte AF</p>
</li>
<li>
<p>En la posición <strong>0x40002</strong> está el byte BF</p>
</li>
<li>
<p>En la posición <strong>0x40003</strong> está el byte CF &#8594; <strong>MSB</strong> (Most Significant Byte)</p>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/ditaa/svg/eNrjcvEMcnV29vT3cw1WgAFnf78QVz9PF38uLgUUoK2LFWiDlBlUGIAASFmNAlZQQ7JphlQ1zYhKpiFrG96mGVSYYIlTiADMEp9gJ5JNRI9XRzdK3Icer04UmWaMZpozsmkKviT5diSllDQQoIZpAA9ft-o=" alt="Diagram">
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>El byte de menor peso se almacena en la posición de memoria más baja. La posición más baja de las cuatro es la 0x4000 donde se almacena el 00, luego este es el byte de menor peso. El dato almacenado en formato little-endian  es el <strong>0xCFBFAF00</strong>.</p>
</li>
<li>
<p>La arquitectura i386/amd64 utiliza LITTLE ENDIAN</p>
</li>
</ul>
</div>
</li>
<li>
<p>Tipos de información que siguen el formato little endian.</p>
<div class="ulist">
<ul>
<li>
<p>Para las instrucciones el formato es por campos por lo que no tiene sentido hablar de posiciones de mayor o menor peso de la instrucción por lo que no siguen el formato little endian.</p>
</li>
<li>
<p>Las cadenas de caracteres (strings) no representan un valor y por lo tanto no siguen el formato little endian.</p>
</li>
<li>
<p>Los números enteros se almacenan siguiendo el formato little endian.</p>
</li>
<li>
<p>Los números reales se almacenan siguiendo el formato little endian</p>
</li>
<li>
<p>Las direcciones de memoria se almacenan siguiendo la organización Little Endian.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Formato Big Endian</p>
<div class="ulist">
<ul>
<li>
<p>El orden de almacenamiento es el inverso al little endian, es decir, el byte LSB del dato se almacena en la dirección de memoria mayor de la región que ocupa el dato.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_ejemplo">6.4.4. Ejemplo</h4>
<div class="ulist">
<ul>
<li>
<p>Analizar el código del programa <a href="_lenguajes_de_programación_en_ensamblador.html#sum1toN_att_32">sum1toN att x86-32</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="repertorio_instruc_oper">6.5. Repertorio de Instrucciones en lenguaje ensamblador (ASM) para la arquitectura i386/amd64: Operaciones</h3>
<div class="sect3">
<h4 id="_ejemplo_2">6.5.1. Ejemplo</h4>
<div class="ulist">
<ul>
<li>
<p>En cada apartado que se estudia a continuación analizar el código del programa <a href="_lenguajes_de_programación_en_ensamblador.html#sum1toN_att_32">sum1toN att x86-32</a> interpretando los códigos de operación.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_manual_rápido">6.5.2. Manual rápido</h4>
<div class="ulist">
<ul>
<li>
<p><a href="http://www.felixcloutier.com/x86/">manual Intel quick</a>: <strong>recomendado</strong></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_manuales_y_tablas">6.5.3. Manuales y Tablas</h4>
<div class="ulist">
<ul>
<li>
<p>Referencias a manuales en el <a href="_lenguajes_de_programación_en_ensamblador.html#leng_asm">Apéndice</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_tipo_de_descripción_de_códigos_de_operación_en_el_manual_de_intel">6.5.4. Tipo de descripción de Códigos de Operación en el Manual de Intel</h4>
<div class="sect4">
<h5 id="_operación_mov">Operación MOV</h5>
<div class="ulist">
<ul>
<li>
<p><a href="http://www.cs.nyu.edu/~mwalfish/classes/ut/s13-cs439/ref/i386/MOV.htm">MOV</a></p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sh">MOV <span class="nt">--</span> Move Data

Opcode   Instruction       Clocks        Description

88  /r   MOV r/m8,r8       2/2           Move byte register to r/m byte
89  /r   MOV r/m16,r16     2/2           Move word register to r/m word
89  /r   MOV r/m32,r32     2/2           Move dword register to r/m dword
8A  /r   MOV r8,r/m8       2/4           Move r/m byte to byte register
8B  /r   MOV r16,r/m16     2/4           Move r/m word to word register
8B  /r   MOV r32,r/m32     2/4           Move r/m dword to dword register
8C  /r   MOV r/m16,Sreg    2/2           Move segment register to r/m word
8D  /r   MOV Sreg,r/m16    2/5,pm<span class="o">=</span>18/19  Move r/m word to segment register
A0       MOV AL,moffs8     4             Move byte at <span class="o">(</span>seg:offset<span class="o">)</span> to AL
A1       MOV AX,moffs16    4             Move word at <span class="o">(</span>seg:offset<span class="o">)</span> to AX
A1       MOV EAX,moffs32   4             Move dword at <span class="o">(</span>seg:offset<span class="o">)</span> to EAX
A2       MOV moffs8,AL     2             Move AL to <span class="o">(</span>seg:offset<span class="o">)</span>
A3       MOV moffs16,AX    2             Move AX to <span class="o">(</span>seg:offset<span class="o">)</span>
A3       MOV moffs32,EAX   2             Move EAX to <span class="o">(</span>seg:offset<span class="o">)</span>
B0 + rb  MOV reg8,imm8     2             Move immediate byte to register
B8 + rw  MOV reg16,imm16   2             Move immediate word to register
B8 + rd  MOV reg32,imm32   2             Move immediate dword to register
C6       MOV r/m8,imm8     2/2           Move immediate byte to r/m byte
C7       MOV r/m16,imm16   2/2           Move immediate word to r/m word
C7       MOV r/m32,imm32   2/2           Move immediate dword to r/m dword</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>MOV NO afecta a ningún flag</p>
</li>
<li>
<p>dword :double word: 32 bits</p>
</li>
<li>
<p>r8: registro de 8 bits</p>
</li>
<li>
<p>r/m8 : registro de cualquier tamaño o posición de memoria de 8 bits</p>
</li>
<li>
<p>imm8 : operando inmediato de 8 bits</p>
</li>
<li>
<p>reg8 : registro de 8 bits</p>
</li>
<li>
<p>Sreg : registros segmento &#8594; CS,DS,ES,FS,GS,SS</p>
</li>
<li>
<p>The moffs8, moffs16, and moffs32 operands specify a simple offset relative to the segment base, where 8, 16, and 32 refer to the size of the data. The address-size attribute of the instruction determines the size of the offset, either 16 or 32 bits.</p>
<div class="listingblock">
<div class="content">
<pre>https://www.intel.es/content/www/es/es/architecture-and-technology/64-ia-32-architectures-software-developer-vol-1-manual.html
3.7.4 Specifying a Segment Selector
The segment selector can be specified either implicitly or explicitly. [...] The processor automatically chooses a segment according to the rules given in Table 3-5.

SS Any memory reference which uses the ESP or EBP register as a base register.

DS All data references, except when relative to stack or string destination.</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
la sintaxis del lenguage ASM de los manuales  no es  la sintaxis de AT&amp;T sino Intel &#8594;  mnemónico operando_destino, operando fuente
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mnemonicos_basicos_explicados">6.6. Mnemónicos Básicos (Explicados)</h3>
<div class="sect3">
<h4 id="_operaciones_aritméticas">6.6.1. Operaciones aritméticas</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.felixcloutier.com/x86/mul">mul</a>: multiplicación de números naturales, sin signo</p>
<div class="listingblock">
<div class="content">
<pre>Performs an unsigned multiplication of the first operand (destination operand) and the second operand (source operand) and stores the result in the destination operand. The destination operand is an implied operand located in register AL, AX or EAX (depending on the size of the operand); the source operand is located in a general-purpose register or a memory location</pre>
</div>
</div>
</li>
<li>
<p><a href="https://www.felixcloutier.com/x86/imul">imul</a>: multiplicación de números enteros con signo</p>
<div class="ulist">
<ul>
<li>
<p>Puede tener 1,2 o 3 operandos</p>
</li>
<li>
<p><code>imull Etiqueta</code> :  R[ %edx ]:R[ %eax ] ← M[Etiqueta] × R[ %eax ]</p>
<div class="listingblock">
<div class="content">
<pre>Performs a signed multiplication of two operands. This instruction has three forms, depending on the number of operands.

    One-operand form — This form is identical to that used by the MUL instruction. Here, the source operand (in a general-purpose register or memory location) is multiplied by the value in the AL, AX, EAX, or RAX register (depending on the operand size) and the product (twice the size of the input operand) is stored in the AX, DX:AX, EDX:EAX, or RDX:RAX registers, respectively.</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://www.felixcloutier.com/x86/div">div</a>: división de números naturales, sin signo</p>
</li>
<li>
<p><a href="https://www.felixcloutier.com/x86/idiv">idiv</a>: división de números enteros con signo</p>
<div class="ulist">
<ul>
<li>
<p>Puede tener 1,2 o 3 operandos</p>
<div class="listingblock">
<div class="content">
<pre>Divides the (signed) value in the AX, DX:AX, or EDX:EAX (dividend) by the source operand (divisor) and stores the result in the AX (AH:AL), DX:AX, or EDX:EAX registers. The source operand can be a general-purpose register or a memory location. The action of this instruction depends on the operand size (dividend/divisor).

Non-integral results are truncated (chopped) towards 0</pre>
</div>
</div>
</li>
<li>
<p><code>idiv</code></p>
<div class="ulist">
<ul>
<li>
<p>EAX&#8592;Cociente{[EDX:EAX]/M[Op_fuente]} , EDX&#8592;Resto{[EDX:EAX]/M[Op_fuente]}</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_extensión_del_signo">6.6.2. Extensión del signo</h4>
<div class="ulist">
<ul>
<li>
<p>movsbw src,Reg &#8594; Mov Sign Byte to Word</p>
</li>
<li>
<p>movsbl src,Reg &#8594; Mov Sign Byte to Long</p>
</li>
<li>
<p>movswl rc,Reg  &#8594; Mov Sign Word to Long</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_cambio_de_tamaño">6.6.3. Cambio de tamaño</h4>
<div class="ulist">
<ul>
<li>
<p>movzbw src,Reg &#8594; Mov Byte to Word</p>
</li>
<li>
<p>movzbl src,Reg &#8594; Mov Byte to Long</p>
</li>
<li>
<p>movzwl src,Reg &#8594; Mov Word to Long</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_operaciones_booleanas">6.6.4. Operaciones Booleanas</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.felixcloutier.com/x86/not">NOT</a></p>
<div class="ulist">
<ul>
<li>
<p>no flags</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://www.felixcloutier.com/x86/and">AND</a></p>
<div class="ulist">
<ul>
<li>
<p>Clear CF,OF</p>
</li>
<li>
<p>Modifica SF,ZF,PF</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://www.felixcloutier.com/x86/or">OR</a></p>
<div class="ulist">
<ul>
<li>
<p>Clear CF,OF</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://www.felixcloutier.com/x86/xor">XOR</a></p>
<div class="ulist">
<ul>
<li>
<p>Clear CF,OF</p>
</li>
<li>
<p>Modifica SF,ZF,PF</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="prog_condicional">6.6.5. Procesamiento Condicional: CMP,TEST,SETcc</h4>
<div class="sect4">
<h5 id="_cmp">CMP</h5>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.felixcloutier.com/x86/cmp">CMP</a></p>
</li>
<li>
<p>Modifica CF,OF,SF,ZF,PF,AF</p>
</li>
<li>
<p>The condition codes used by the Jcc, CMOVcc, and SETcc instructions are based on the results of a CMP instruction</p>
</li>
<li>
<p>Compares the first source operand with the second source operand and sets the status flags in the EFLAGS register according to the results. The comparison is performed by subtracting the second operand from the first operand and then setting the status flags in the same manner as the <strong>SUB instruction</strong>. When an immediate value is used as an operand, it is sign-extended to the length of the first operand.</p>
<div class="ulist">
<ul>
<li>
<p>Es decir, hay que saber interpretar la instrucción de resta SUB y en concreto el flag OF  para signed overflow y CF para unsigned overflow.</p>
</li>
<li>
<p>Ejercicios:</p>
<div class="ulist">
<ul>
<li>
<p>Realizar el <a href="_ejercicios_3.html#cmp_ejercicio">ejercicio instrucción CMP</a> y también en el guión de prácticas que se estudia los saltos realizar la interpretación manual de las instrucciones CMP.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_sub">SUB</h5>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.felixcloutier.com/x86/sub">SUB</a></p>
</li>
<li>
<p>Subtracts the second operand (source operand) from the first operand (destination operand) and stores the result in the destination operand. When an immediate value is used as an operand, it is sign-extended to the length of the destination operand format.</p>
</li>
<li>
<p>The SUB instruction performs integer subtraction.</p>
</li>
<li>
<p>It evaluates the result for both signed and unsigned integer operands and sets the OF and CF flags to indicate an overflow in the signed or unsigned result, respectively. The SF flag indicates the sign of the signed result.</p>
<div class="ulist">
<ul>
<li>
<p>Es decir, realiza la resta tanto interpretando los operandos como números naturales y números con signo ya que la representación binaria del resultado es la misma. En caso de overflow utiliza el flag OF para la interpretación con signo y para el overflow sin signo el flag CF.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_test">TEST</h5>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.felixcloutier.com/x86/test">TEST</a></p>
<div class="ulist">
<ul>
<li>
<p>Computes the bit-wise logical <strong>AND</strong> of first operand (source 1 operand) and the second operand (source 2 operand)</p>
</li>
<li>
<p>Clear CF,OF</p>
</li>
<li>
<p>Modifica SF,ZF,PF</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_setcc">SETcc</h5>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.felixcloutier.com/x86/setcc">SETcc</a></p>
<div class="ulist">
<ul>
<li>
<p>SETcc operand</p>
</li>
<li>
<p>No modifica ningún flag. Modifica el operando si se cumple la condición.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_mov">MOV</h5>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.felixcloutier.com/x86/mov">MOV</a></p>
<div class="ulist">
<ul>
<li>
<p>La instrucción MOV no afecta a ningún flag del registro EFLAG</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_saltos">6.6.6. Saltos</h4>
<div class="sect4">
<h5 id="_condicionales_jcc">Condicionales: Jcc</h5>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.felixcloutier.com/x86/jcc">Jcc</a></p>
<div class="ulist">
<ul>
<li>
<p>Comprueba la condición y si se cumple se ejecuta el salto a la dirección referenciada en el campo de operando.</p>
</li>
<li>
<p>jump short: el valor del operando es relativo al PC</p>
</li>
<li>
<p>Chequea los flags CF, OF, PF, SF, and ZF.</p>
</li>
<li>
<p>"less” and “greater”: compara números con signo: jl, jle, jg, jge, etc&#8230;&#8203;</p>
</li>
<li>
<p>“above” and “below” : compara números sin signo: ja, jae, jb, jbe, etc&#8230;&#8203;</p>
</li>
</ul>
</div>
</li>
<li>
<p>Antes de un salto condicional es necesario ejecutar algún tipo de instrucción donde la relación (aritmética, lógica, etc ) de los operandos sea condición para la ejecución del salto. Instrucciones previas pueden ser: CMP y TEST.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_indirectos">Indirectos</h5>
<div class="paragraph">
<p>Símbolo <code>*</code>:</p>
</div>
<div class="paragraph">
<p>El Símbolo asterisco  para indicar indirección en los saltos y diferenciarlos del direccionamiento relativo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>jmp bucle   -&gt; salto relativo a EIP
jmp *bucle
jmp *eax
jmp *(eax)
jmp *(mem)
jmp *table(%ebx,%esi,4)</pre>
</div>
</div>
<div class="paragraph">
<p>En cambio en los movimientos MOV no hace falta el símbolo asterisco ya que no hay movimientos con direccionamiento relativo.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_desplazamiento_y_rotación">6.6.7. Desplazamiento y rotación</h4>
<div class="ulist">
<ul>
<li>
<p><code>sar</code>,<code>sal</code> : Shift Arithmetic Right, Shift Arithmetic Left.</p>
<div class="ulist">
<ul>
<li>
<p>desplazamiento aritmético: El digito entrante por la izda o dcha es el bit de signo.</p>
<div class="listingblock">
<div class="content">
<pre>Shifts the bits in the first operand (destination operand) to the left or right by the number of bits specified in the second operand (count operand). Bits shifted beyond the destination operand boundary are first shifted into the CF flag, then discarded. At the end of the shift operation, the CF flag contains the last bit shifted out of the destination operand.</pre>
</div>
</div>
</li>
<li>
<p><code>sarl $31, %edx</code> : desplazamiento de 31 bits a la dcha y el bit entrante es el bit de signo el operando en EDX.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>shr</code>,<code>shl</code></p>
</li>
<li>
<p>desplazmiento lógico: entran ceros</p>
<div class="ulist">
<ul>
<li>
<p>Ejemplos de multiplicación y división</p>
</li>
</ul>
</div>
</li>
<li>
<p>ROL,ROR : rotación hacia la izquierda y rotación hacia la derecha.</p>
<div class="ulist">
<ul>
<li>
<p>el bit que sale fuera se copia en CF</p>
</li>
<li>
<p>Aplicación: conversión endianess</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_cambiar_el_endianess">6.6.8. Cambiar el Endianess</h4>
<div class="listingblock">
<div class="content">
<pre>## Cambio del endianess en EAX. Previamente guarda el original de EAX y al final restaura EAX
swapbytes:
       xchg (%ebx), %eax
       bswap %eax
       xchg (%ebx), %eax</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_formato_de_instrucción_isa_intel_x86_64">6.7. Formato de Instrucción: ISA Intel x86-64</h3>
<div class="ulist">
<ul>
<li>
<p>Apéndice <a href="_lenguajes_de_programación_en_ensamblador.html#form_inst">Formato Instrucción</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_subrutinas">6.8. Subrutinas</h3>
<div class="sect3">
<h4 id="_referencias_2">6.8.1. Referencias</h4>
<div class="ulist">
<ul>
<li>
<p><a href="_ix_bibliografía.html#ABI_i386">ABI x86-32</a></p>
</li>
<li>
<p><a href="_ix_bibliografía.html#ms_llamada">Convenio de LLamada MicroSoft</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_introducción_4">6.8.2. Introducción</h4>
<div class="ulist">
<ul>
<li>
<p>Las subrutinas en lenguaje ensamblador son el equivalente a las funciones en el lenguaje de programación en C, por lo que es necesario repasar el concepto de función en el lenguaje C.</p>
</li>
<li>
<p>En la sesión de practicas 5 se programarán subrutinas.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_lenguaje_c_sentencia_función">6.8.3. Lenguaje C: Sentencia Función</h4>
<div class="sect4">
<h5 id="_introducción_5">Introducción</h5>
<div class="paragraph">
<p>El objetivo de las funciones es descomponer el programa en módulos de código para dotar al programa de una estructura organizada que facilite el desarrollo del programa y su mantenimiento.
La librería standard "libc" son colecciones de funciones básicas desarrolladas en el lenguaje C que son reutilizadas por la mayoría de los programas. De esta manera el programador no tiene que inventar la rueda.
Por lo tanto en un programa coexisten funciones desarrolladas por el propio usuario en lenguaje C y funciones de librerías accesibles en código binario.</p>
</div>
</div>
<div class="sect4">
<h5 id="_declaración">Declaración</h5>
<div class="ulist">
<ul>
<li>
<p>La <strong>declaración</strong> de una función en lenguaje C se denomina <strong>prototipo</strong>. Ejemplo de prototipo: <code>int sumMtoN(short sumando1, short sumando2)</code>
donde</p>
<div class="ulist">
<ul>
<li>
<p>Nombre: el nombre de la función es <em>sumMtoN</em></p>
</li>
<li>
<p>Argumentos: el nombre del primer argumento es <em>sumando1</em> y es del tipo short, el nombre del 2º argumento es <em>sumando2</em> y es del tipo shrot.</p>
</li>
<li>
<p>Tipo del valor de retorno: el tipo del valor de retorno es int.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_definición">Definición</h5>
<div class="ulist">
<ul>
<li>
<p>La <strong>definición</strong> de la función <em>sumMtoN</em> consiste en desarrollar el algoritmo mediante sentencias de C, es decir, el cuerpo de la función:</p>
<div class="listingblock">
<div class="content">
<pre>int sumMtoN(short sumando1, short sumando2)   {
      //sumando2 &gt; sumando1
      short i;
      int resultado=0; // variable local a la función
      i=sumando2;
        while (i &gt;= sumando1) {
          resultado += i ;
          i--;
        }
      printf("\n\t Subrutina sumMtoN \n");
      return resultado;
    }</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>resultado es la variable que contiene el valor de retorno</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_llamada_y_retorno">LLamada y Retorno</h5>
<div class="ulist">
<ul>
<li>
<p>La función <em>main()</em> llama a la función <em>sumMtoN()</em> la cual después de ser ejecutada devuelve el resultado de la suma.</p>
<div class="listingblock">
<div class="content">
<pre>/*
   Programa: sumMtoN.c
   Compilación: gcc -g -ggdb3 -o sumMtoN sumMtoN.c
                -ggdb3 : inserta en la tabla de símbolos del depurador información de macros
                https://gcc.gnu.org/onlinedocs/gcc-12.2.0/gcc/Debugging-Options.html#Debugging-Options
*/

// Prototipos de las funciones
#include &lt;stdio.h&gt;  // Declaración de la función printf()
#include &lt;stdlib.h&gt;  // Declaración de la función exit()

//Macros
#define SUCCESS   0

//Prototipos: declaración de la función sumMtoN()
int sumMtoN(short sumando1, short sumando2);

// Definición de la Función Principal main()
void main(void) {
       //Inicialización de los argumentos M y N de la función sumMtoN()
       short M=1, N=1, longitud;
       // Llamada a las funciones printf() y sumMtoN()
       longitud=printf("El resultado de la suma es %d \n", sumMtoN(M,N));
       printf("El número de caracteres de la cadena anterior impresa es %d\n",longitud);
       // La evaluación de sumMtoN consiste en:  llamar a la función y capturar el valor de retorno.
       // Llamada a la función exit
       exit(SUCCESS);
     }

// Definición de las Funciones
int sumMtoN(short sumando1, short sumando2)   {
      //sumando2 &gt; sumando1
      short i;
      int resultado=0; // variable local a la función
      i=sumando2;
        while (i &gt;= sumando1) {
          resultado += i ;
          i--;
        }
      printf("\n\t Subrutina sumMtoN \n");
      return resultado;
    }</pre>
</div>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>La <strong>evaluación</strong> de sumMtoN() consiste enobtener el <strong>valor de retorno</strong> de la ejecución de la función <em>sumMtoN()</em></p>
</li>
<li>
<p>printf &#8594; sumMtoN : printf llama a sumMtoN , se evalua sumMtoN y se imprime el resultado de evaluar la función <em>sumMtoN()</em>.</p>
</li>
<li>
<p>El valor de retorno de la función printf() es el número de caracteres de la cadena impresa. Abrir un terminal y ejecutar el manual "man 3" para leer el apartado "RETURN VALUE".</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_anidamiento_de_funciones">6.8.4. Anidamiento de Funciones</h4>
<div class="ulist">
<ul>
<li>
<p>Anidamiento de llamadas: init() &#8594; main() &#8594; sumMtoN() &#8594; printf() &#8594; write()</p>
</li>
<li>
<p>El shell el sistema operativo GNU/linux llama a la función principal main()  del programa de usuario, que a su vez llama a la función printf() de la librería libc , la cual a su vez llama a la función de usuario sumMtoN() y a la función  write() del sistema operativo.</p>
</li>
<li>
<p>Retorno:</p>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/ditaa/svg/eNorL8osSdXQ1NXVtdPmUkCAGmSONlC2oCgzryRNQ1NB104hNzEzTwHCTK3ILAFqt1MozkjNyUE1obg017ck3w8krQ0Av_gYKA==" alt="Diagram">
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_pilaframe">6.8.5. Pila/Frame</h4>
<div class="ulist">
<ul>
<li>
<p>Ver concepto de pila en el <a href="_pila.html#pila">Apéndice</a>.</p>
</li>
<li>
<p>La pila es una <em>sección</em> del programa en ejecución en la memoria principal. A diferencia de la sección de datos y la sección de instrucciones la pila se crea en tiempo de ejecución ,no durante la carga en memoria.</p>
</li>
<li>
<p>Los argumentos M y N de la función <em>sumMtoN()</em> se pasan de la función main() a la función <em>sumMtoN()</em> a través de la pila.</p>
</li>
<li>
<p>Partición de la pila en frames: Cada función del programa tiene su zona limitada dentro del <em>segmento</em> de pila. A cada zona limitada asociada a cada función se le denomina <strong>frame</strong>. Por lo tanto en la sección pila se irán anidando frames cada vez que se llame a un función, e irán desapareciendo frames cada que vez que se retorne de un función.</p>
<div class="ulist">
<ul>
<li>
<p>La función <em>main()</em> crea su frame cuando es llamada por el shell y la función <em>sumMtoN</em> crea su propio frame cuando es llamada por main().</p>
</li>
<li>
<p>Los frames se apilan según se anidan las llamadas a subrutinas. Y se desactivan según retornan.</p>
</li>
<li>
<p>Dinamismo: En un momento dado de la ejecución del programa el último frame generado es el frame activo.</p>
<div class="ulist">
<ul>
<li>
<p>La parte baja del frame activo esta referenciada por el puntero EBP y la parte alta del frame (top) por el puntero ESP. Los términos bajo y alto hacen referencia a la dirección del <strong>apilamiento</strong> y no a direcciones de memoria. Parte baja y alta del apilamiento.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_argumentos_de_la_subrutina">6.8.6. Argumentos de la subrutina</h4>
<div class="ulist">
<ul>
<li>
<p>Los argumentos deben de transferirse a través de la pila y antes de realizar la llamada.</p>
</li>
<li>
<p>Los argumentos se apilan uno detrás de otro comenzando por el último argumento y finalizando con el primer argumento.</p>
</li>
<li>
<p>Se apilan mediante la  instrucción <code>push argumento</code> donde el operando es el argumento a transferir.</p>
<div class="listingblock">
<div class="content">
<pre>push N
push M</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_llamada_a_la_subrutina">6.8.7. Llamada a la subrutina</h4>
<div class="ulist">
<ul>
<li>
<p>La rutina llamante <em>main</em> llama a la subrutina <em>sumMtoN</em> mediante la instrucción <code>call sumMtoN</code>. Por lo que la rutina <em>main</em> queda interrumpida hasta que finalice la ejecución de la subrutina <em>sumMtoN</em>.</p>
</li>
<li>
<p>La instrucción <code>call</code> se ejecuta en dos fases:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Apila la dirección de retorno: en la rutina <em>main</em> siguiente instrucción a <code>call sumMtoN</code>: <strong>ESP &#8592; ESP-4</strong> y  <strong>M[ESP] &#8592; PC</strong></p>
</li>
<li>
<p>Salta a la etiqueta <em>sumMtoN</em>: <strong>PC &#8592; sumMtoN</strong></p>
</li>
</ol>
</div>
</li>
<li>
<p>básicamente la instrucción call es una salto con retorno a la dirección donde fue interrumpida la rutina llamante.</p>
<div class="listingblock">
<div class="content">
<pre>push N
push M
call sumMtoN</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_definición_de_la_subrutina">6.8.8. Definición de la subrutina</h4>
<div class="ulist">
<ul>
<li>
<p>Nombre: <em>sumMtoN</em></p>
</li>
<li>
<p>El nombre de la subrutina es la etiqueta que apunta a la primera instrucción de la subrutina.</p>
</li>
<li>
<p>La subrutina finaliza con la instrucción ret.</p>
</li>
<li>
<p>La subrutina está estructurada en 3 partes:</p>
<div class="ulist">
<ul>
<li>
<p>Prólogo:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Salvar los registros que van a ser modificados por el cuerpo de la subrutina.</p>
</li>
<li>
<p>Activar el nuevo frame inicializando los punteros <code>EBP</code> y <code>ESP</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Cuerpo:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Capturar los argumentos y procesarlos</p>
</li>
</ol>
</div>
</li>
<li>
<p>Epílogo:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Salvar el valor de retorno en el registro <code>EAX</code></p>
</li>
<li>
<p>Recuperar el valor de los registros salvados en el Prólogo</p>
</li>
<li>
<p>Activar el frame de la función que ha realizado la llamada actualizando <code>EBP</code> y <code>ESP</code> con sus antiguos valores.</p>
</li>
<li>
<p>Retorno a la función que ha realizado la llamada.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Código</p>
<div class="listingblock">
<div class="content">
<pre># Comienzo de la subrutina
sumMtoN:
# Prólogo
		push  %ebp 	# salvo el bottom del frame de la función llamante en la parte baja del nuevo frame
		mov   %esp,%ebp # configuro el puntero %ebp apuntando a la parte baja del nuevo frame
		push   xxx      # Si fuera necesario: salvar registros que se utilizarán en el Cuerpo de la subrutina
		push   xxx
# Cuerpo
		mov 8(%ebp),%ebx	#capturo el 1º argumento
		mov 12(%ebp),%ecx	#capturo el 2º argumento
		xxx xxx
		xxx xxx
# Epílogo
		mov resultado,%eax	#inicializo el valor de retorno
                pop   xxx               #recuperar registros que se salvaron en el prólogo
		pop   xxx
                mov %ebp,%esp
                pop %ebp
		ret</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_registros_a_preservar">6.8.9. Registros a Preservar</h4>
<div class="sect4">
<h5 id="_rutina_llamante_arquitectura_i386">Rutina llamante: arquitectura i386</h5>
<div class="paragraph">
<p>La rutina que realiza la llamada (caller routine) está obligada a preservar los siguientes registros si los está utilizando:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>EAX-ECX-EDX</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Es decir, dichos registros pueden ser utilizados libremente por la subrutina llamada. En caso de no ser utilizados por la subrutina no sería necesario preservarlos. En caso de ser utilizados se copiarían en la pila antes de realizar la llamada a la subrutina y serían recuperados al finalizar la subrutina.</p>
</div>
</div>
<div class="sect4">
<h5 id="_subrutina_llamada_arquitectura_i386">Subrutina llamada: arquitectura i386</h5>
<div class="paragraph">
<p>La subrutina llamada (callee routine) está obligada a preservar los siguientes registros:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>EBX-ESP-EBP-ESI-EDI y X87CW</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Es decir, dichos registros al finalizar la subrutina de mantener el mismo valor que antes de la llamada. En caso de no utilizarlos no sería necesario preservarlos</p>
</div>
</div>
<div class="sect4">
<h5 id="_arquitectura_amd64">Arquitectura amd64</h5>
<div class="paragraph">
<p>Caller routine: The registers RAX, RCX, RDX, R8, R9, R10, R11 are considered volatile and must be considered destroyed on function calls (unless otherwise safety-provable by analysis such as whole program optimization).</p>
</div>
<div class="paragraph">
<p>Callee routine: The registers RBX, RBP, RDI, RSI, RSP, R12, R13, R14, and R15 are considered nonvolatile and must be saved and restored by a function that uses them.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_retorno_de_la_subrutina">6.8.10. Retorno de la subrutina</h4>
<div class="ulist">
<ul>
<li>
<p>La última instrucción de la subrutina es <strong>RET</strong> cuya ejecución por la Unidad de Control de la CPU realiza las siguientes órdenes:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><strong>PC &#8592; M[ESP]</strong> : extrae de la pila la dirección de retorno guardada por la instrucción <strong>CALL</strong> y la carga en el Contador de Programa, por lo que se ejecutará el ciclo de instrucción de la instrucción posterior a <strong>call sumMtoN</strong></p>
</li>
<li>
<p>Actualiza el stack pointer: <strong>ESP &#8592; ESP + 4</strong></p>
</li>
</ol>
</div>
</li>
<li>
<p>Es necesario que en el epílogo de la subrutina, antes de la ejecución de RET el stack pointer apunte a la dirección de la pila donde está almacenada la dirección de retorno.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_estado_de_la_pila">6.8.11. Estado de la pila</h4>
<div class="sect4">
<h5 id="_análisis">Análisis</h5>
<div class="ulist">
<ul>
<li>
<p>La pila es una estructura dinámica cuyo estado (registros puntero EIP,EBP,ESP) cambian según se realizan llamadas y retornos de subrutinas. Razonar el contenido de dichos registros y verificarlo con el depurador GDB.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_previo_al_salto_de_la_llamada_a_la_subrutina">Previo al salto  de la llamada a la subrutina</h5>
<div class="ulist">
<ul>
<li>
<p>Estado de la pila ejecutando la <em>rutina main</em> justo antes de ejecutar la instrucción <code>call sumMtoN</code>:</p>
<div class="ulist">
<ul>
<li>
<p>El frame activo de la pila es el correspodiente a main.</p>
</li>
<li>
<p>Los últimos datos apilados en el <em>frame main</em> son los argumentos de <em>sumMtoN</em></p>
<div class="listingblock">
<div class="content">
<pre>	push N
	push M
	call sumMtoN</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Analizar el contenido de los  registros EIP,EBP,ESP:</p>
<div class="ulist">
<ul>
<li>
<p>EIP: instruction pointer    &#8594;</p>
</li>
<li>
<p>EBP: stack bottom pointer   &#8594;</p>
</li>
<li>
<p>ESP: stack top pointer      &#8594;</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_posterior_al_salto_de_la_llamada_a_la_subrutina">Posterior al salto de la llamada a la subrutina</h5>
<div class="ulist">
<ul>
<li>
<p>Estado de la pila ejecutando la <em>subrutina sumMtoN</em> justo después de ejecutar el salto <code>call sumMtoN</code>:</p>
<div class="ulist">
<ul>
<li>
<p>El frame activo de la pila es el correspodiente a main.</p>
</li>
<li>
<p>El último dato apilado en el frame main es la <em>dirección de retorno</em> a main desde sumMtoN</p>
</li>
</ul>
</div>
</li>
<li>
<p>Analizar el contenido de los  registros EIP,EBP,ESP:</p>
<div class="ulist">
<ul>
<li>
<p>EIP: instruction pointer    &#8594;</p>
</li>
<li>
<p>EBP: stack bottom pointer   &#8594;</p>
</li>
<li>
<p>ESP: stack top pointer      &#8594;</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_creación_del_nuevo_frame_summton">Creación del nuevo frame <em>sumMtoN</em></h5>
<div class="ulist">
<ul>
<li>
<p>Estado de la pila después de ejecutar:</p>
<div class="listingblock">
<div class="content">
<pre>sumMtoN:
	push %ebp
	mov  %esp,%ebp</pre>
</div>
</div>
</li>
<li>
<p>Analizar el contenido de los  registros EIP,EBP,ESP:</p>
<div class="ulist">
<ul>
<li>
<p>EIP: instruction pointer    &#8594;</p>
</li>
<li>
<p>EBP: stack bottom pointer   &#8594;</p>
</li>
<li>
<p>ESP: stack top pointer      &#8594;</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_previo_al_salto_de_retorno">Previo al salto de retorno</h5>
<div class="ulist">
<ul>
<li>
<p>Estado de la pila ejecutando la <em>subrutina sumMtoN</em> justo antes de ejecutar la instrucción <code>ret</code>:</p>
<div class="ulist">
<ul>
<li>
<p>El frame activo de la pila es el correspodiente a sumMtoN.</p>
</li>
<li>
<p>El puntero del top <em>ESP</em>  del frame sumMtoN apunta a la dirección de pila que contiene la <em>dirección de retorno</em></p>
</li>
</ul>
</div>
</li>
<li>
<p>Analizar el contenido de los  registros EIP,EBP,ESP:</p>
<div class="ulist">
<ul>
<li>
<p>EIP: instruction pointer    &#8594;</p>
</li>
<li>
<p>EBP: stack bottom pointer   &#8594;</p>
</li>
<li>
<p>ESP: stack top pointer      &#8594;</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_posterior_al_salto_de_retorno">Posterior al salto de retorno</h5>
<div class="ulist">
<ul>
<li>
<p>Estado de la pila ejecutando la <em>subrutina sumMtoN</em> justo después de ejecutar la instrucción <code>ret</code>:</p>
<div class="ulist">
<ul>
<li>
<p>La ejecución de <code>ret</code> ha realizado las siguientes operaciones:</p>
<div class="ulist">
<ul>
<li>
<p><code>pop %irp</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>El frame activo de la pila es el correspodiente a main.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Analizar el contenido de los  registros EIP,EBP,ESP:</p>
<div class="ulist">
<ul>
<li>
<p>EIP: instruction pointer    &#8594;</p>
</li>
<li>
<p>EBP: stack bottom pointer   &#8594;</p>
</li>
<li>
<p>ESP: stack top pointer      &#8594;</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ejercicios_de_programación_práctica">6.8.12. Ejercicios de programación práctica</h4>
<div class="ulist">
<ul>
<li>
<p>Ir al capítulo de <a href="_ejercicios_3.html#ejer_llamada_subru">Ejercicios</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_llamadas_al_sistema_operativo">6.9. Llamadas al Sistema Operativo</h3>
<div class="sect3">
<h4 id="_introducción_6">6.9.1. Introducción</h4>
<div class="ulist">
<ul>
<li>
<p>Se conoce con el nombre de <em>llamadas al sistema</em> a las Llamadas que realizar el programa de usuario a subrutinas del Kernel del Sistema Operativo.</p>
</li>
<li>
<p>Para realizar funciones privilegiadas del sistema operativo como el acceso a los dispositivos i/o de la computadora es necesario que los programas de usuario llamen al kernel para que sea éste quien realice la operación de una manera segura y eficaz. De esta forma se evita que el programador de aplicaciones acceda al hardware y al mismo tiempo se facilita la programación.</p>
</li>
<li>
<p>Ejemplos de llamadas</p>
<div class="ulist">
<ul>
<li>
<p><strong>exit</strong> : el kernel suspende la ejecución del programa eliminando el proceso</p>
</li>
<li>
<p><strong>read</strong> : el kernel lee los datos de un fichero accediendo al disco duro</p>
</li>
<li>
<p><strong>write</strong>: el kernel escribe en un fichero</p>
</li>
<li>
<p><strong>open</strong> : el kernel abre un fichero</p>
</li>
<li>
<p><strong>close</strong>: el kernel cierra el proceso</p>
</li>
<li>
<p>más ejemplos de llamada en el listado <code>man 2 syscalls</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>La llamada a los servicios del kernel denominados <em>syscalls</em> se puede realizar de dos formas: <strong>directa</strong> o <strong>indirecta</strong></p>
<div class="ulist">
<ul>
<li>
<p>Directa: desde ASM mediante la instrucción <code>syscall</code></p>
</li>
<li>
<p>Indirecta: desde C o ASM mediante funciones de la librería <code>libc</code>: wrappers de las llamadas directas</p>
</li>
</ul>
</div>
</li>
<li>
<p>API/ABI</p>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/ditaa/svg/eNqNUUEKwjAQvOcVe2wp_YJQo2AvHorgOS0RgmksSRsJ5PHWanQbrDqXhM0wO5MhYJzpeQsNkxKumnUd15CkkK-AwmlQTS8uisALHt-h3G_KaksPBZpakuULyIifKBSkqDXT7n42T60Ro5fJx7icGcPbWjoQyvR6eNjwaPUM_svT34wQ5bfUO6CPAqJpIBXrEkla-AQbW5xw5lpxGXMRLQkfFooyKaIt1jCvJJLfHW8uzG55" alt="Diagram">
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_arquitectura_amd64_2">6.9.2. Arquitectura amd64</h4>
<div class="sect4">
<h5 id="_códigos_de_llamada">Códigos de llamada</h5>
<div class="ulist">
<ul>
<li>
<p>'/usr/include/asm/unistd_64.h ': declaración de macros con el código de la llamada en la arquitectura x86-64</p>
</li>
<li>
<p><em>/usr/include/bits/syscall.h</em>  : macros antiguas también válidas en la arquitectura x86-32</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_argumentos">Argumentos</h5>
<div class="ulist">
<ul>
<li>
<p>Ejemplo arquitectura <strong>amd64</strong></p>
<div class="ulist">
<ul>
<li>
<p>Para pasar los argumentos no se utiliza la pila (memoria externa) sino los registros RPG (memoria interna de la CPU)</p>
</li>
<li>
<p>Los 6 primeros argumentos se pasan a través de los registros: [RAX-RDI-RSI-RDX-R10-R8-R9] previamente a la instrucción de la llamada <code>syscall</code></p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c"><span class="o">*</span> <span class="n">printf</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">write</span><span class="p">(</span><span class="kt">int</span> <span class="n">fd</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">count</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="n">RAX</span><span class="o">-</span><span class="n">RDI</span><span class="o">-</span><span class="n">RSI</span><span class="o">-</span><span class="n">RDX</span><span class="o">-</span><span class="n">R10</span><span class="o">-</span><span class="n">R8</span><span class="o">-</span><span class="n">R9</span><span class="p">,</span><span class="n">syscall</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="n">kernel</span> <span class="n">syscall</span> <span class="n">write</span>
<span class="o">*</span> <span class="n">API</span>      <span class="o">-&gt;</span>        <span class="n">wrapper</span> <span class="n">function</span>                      <span class="o">-&gt;</span>                <span class="n">ABI</span>                  <span class="o">-&gt;</span>  <span class="n">kernel</span> <span class="n">syscall</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_ejemplos_amd64">Ejemplos amd64</h5>
<div class="ulist">
<ul>
<li>
<p>Ver en el <a href="_llamadas_al_sistema_operativo_2.html#llamadas_SO">Apéndice</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_arquitectura_i386">6.9.3. Arquitectura i386</h4>
<div class="sect4">
<h5 id="_norma">Norma</h5>
<div class="ulist">
<ul>
<li>
<p>ABI SystemV i386: Aplication Binary Interface (ABI)</p>
<div class="ulist">
<ul>
<li>
<p>La norma ABI SystemV i386 es la norma oficial donde se describe la interfaz binaria, es decir, como se comunican los distintos módulos de un programa a nivel binario, a  nivel de lenguaje máquina.</p>
</li>
<li>
<p>La llamada al kernel se realiza mediante la instrucción <code>int $0x80</code> donde int es el mnemónico de interrupción (se interrumpe el programa de usuario en ejecución para llamar a una función del kernel)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_códigos_de_llamada_2">6.9.4. Códigos de llamada</h4>
<div class="ulist">
<ul>
<li>
<p><em>/usr/include/asm/unistd_32.h</em> : declaración de macros con el código de la llamada</p>
<div class="ulist">
<ul>
<li>
<p><em>/usr/include/bits/syscall.h</em>: macros antiguas también válidas</p>
</li>
</ul>
</div>
</li>
<li>
<p>llamadas típicas:</p>
<div class="ulist">
<ul>
<li>
<p><strong>exit-fork-read-write-open-close-&#8230;&#8203;</strong></p>
<table class="tableblock frame-all grid-all" style="width: 80%;">
<colgroup>
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top" colspan="3">exit - terminate current process</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">In</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">eax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ebx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">return code</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Out</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">(This call does not return)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="3"><p class="tableblock"><strong>fork - create child process</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">In</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">eax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">eax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0 in the clone; process id of clone or EAGAIN or ENOMEM in caller</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="3"><p class="tableblock"><strong>read - read from file or device</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">In</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">eax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ebx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">file descriptor</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ecx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">address of the buffer to read into</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">edx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">maximum number of bytes to read</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">eax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number of bytes actually read  :  EAGAIN  :  EBADF  :  EFAULT  :  EINTR  :  EINVAL  :  EIO  :  EISDIR</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="3"><p class="tableblock"><strong>write - write to file or device</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">In</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">eax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ebx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">file descriptor</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ecx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">address of the buffer to write from</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">edx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">maximum number of bytes to write</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">eax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number of bytes actually sent  :  EAGAIN  :  EBADF  :  EFAULT  :  EINTR  :  EINVAL  :  EIO  :  ENOSPC  :  EPIPE</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="3"><p class="tableblock"><strong>open - open, create, or truncate a file or device</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">In</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">eax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ebx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">address of zero-terminated pathname</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ecx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">file access bits</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">edx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">file permission mode</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">eax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">file descriptor of opened file  :  EACCESS  :  EEXIST  :  EFAULT  :  EISDIR  :  ELOOP  :  EMFILE,  :  ENAMETOOLONG  :  ENFILE  :  ENOENT  :  ENODEV  :  ENODIR  :  ENOMEM  :  ENOSPC  :  ENXIO  :  EROFS  :  ETXTBSY</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="3"><p class="tableblock"><strong>close - close a file or device</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">In</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">eax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ebx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">file descriptor</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">eax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">zero for success  :  EBADF</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="3"><p class="tableblock"><strong>waitpid - wait for a processes to terminate</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">In</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">eax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ebx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">process id of the process to wait for</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ecx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0, or address of buffer to hold exit state</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">edx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">option flags  :  0  :  WNOHANG  :  WUNTRACED</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">eax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pid of finished process  :  ECHILD  :  EINVAL  :  ERESTART</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ecx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">exit state of finished process, if non-zero value was input in ecx</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="3"><p class="tableblock"><strong>create - create a file</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">In</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">eax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ebx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">address of zero-terminated pathname</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ecx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">file permission mode</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">eax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">file descriptor of opened file  :  EACCESS  :  EEXIST  :  EFAULT  :  EISDIR  :  ELOOP  :  EMFILE,  :  ENAMETOOLONG  :  ENFILE  :  ENOENT  :  ENODEV  :  ENODIR  :  ENOMEM  :  ENOSPC  :  ENXIO  :  EROFS  :  ETXTBSY</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Note</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">This call is identical to calling open with access bits O_CREATE : O_WRONLY : O_TRUNC</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="3"><p class="tableblock"><strong>link - create a hard link to a file</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">In</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">eax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ebx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">address of zero-terminated pathname of existing file name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ecx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">address of zero-terminated pathname of new name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">eax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0  :  EACCESS  :  EIO  :  EPERM  :  EEXIST  :  EFAULT  :  ELOOP  :  EMLINK  :  ENAMETOOLONG  :  ENOENT  :  ENOMEM  :  ENOSPC  :  ENOTDIR  :  EPERM  :  EROFS  :  EXDEV</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="3"><p class="tableblock"><strong>unlink - delete a name and remove file when not busy</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">In</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">eax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ebx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">address of zero-terminated pathname of existing file name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">eax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0  :  EACCES  :  EFAULT  :  EIO  :  EISDIR  :  ELOOP  :  ENAMETOOLONG  :  ENOENT  :  ENOMEM  :  ENOTDIR  :  EPERM  :  EROFS</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="3"><p class="tableblock"><strong>execve - execute a program</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">In</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">eax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ebx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">address of zero-terminated pathname of program</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ecx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">address of zero-terminated list of addresses of zero-terminated argument strings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">edx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">address of zero-terminated list of addresses of zero-terminated environment strings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">eax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If success, no return because the new program inherits resources and overwrites caller; otherwise: E2BIG  :  EACCES  :  EINVAL  :  EIO  :  EISDIR  :  ELIBBAD  :  ELOOP  :  ENFILE  :  ENOEXEC  :  ENOENT  :  ENOMEM  :  ENOTDIR  :  EFAULT  :  ENAMETOOLONG  :  EPERM  :  ETXTBUSY</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="3"><p class="tableblock"><strong>chdir - change working directory</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">In</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">eax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ebx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">address of zero-terminated pathname of existing directory</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">eax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0  :  EACCES  :  EBADF  :  EFAULT  :  EIO  :  ELOOP  :  ENAMETOOLONG  :  ENOENT  :  ENOMEM  :  ENOTDIR</p></td>
</tr>
</tbody>
</table>
</li>
</ul>
</div>
</li>
<li>
<p>File descriptors</p>
<div class="ulist">
<ul>
<li>
<p>0 (STDIN): The standard input for the terminal device (normally the keyboard). Diferenciar la macro STDOUT_FILEIN de la macro stdin.</p>
</li>
<li>
<p>1 (STDOUT): The standard output for the terminal device (normally the terminal screen). Diferenciar la macro STDOUT_FILENO de la macro stdout.</p>
</li>
<li>
<p>2 (STDERR): The standard error output for the terminal device (normally the terminal screen)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_como_pasar_los_argumentos">Como pasar los argumentos</h5>
<div class="ulist">
<ul>
<li>
<p>Para pasar los argumentos no se utiliza la pila (memoria externa) sino los registros RPG (memoria interna de la CPU)</p>
</li>
<li>
<p>Los 6 primeros argumentos se pasan a través de los registros: [EBX-ECX-EDX-ESI-EDI-EBP] previamente a la instrucción de la llamada <code>int $0x80</code></p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c"><span class="o">*</span> <span class="n">printf</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">write</span><span class="p">(</span><span class="kt">int</span> <span class="n">fd</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">count</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="n">EBX</span><span class="o">-</span><span class="n">ECX</span><span class="o">-</span><span class="n">EDX</span><span class="o">-</span><span class="n">ESI</span><span class="o">-</span><span class="n">EDI</span><span class="o">-</span><span class="n">EBP</span><span class="p">,</span><span class="kt">int</span> <span class="mh">0x80</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="n">kernel</span> <span class="n">syscall</span> <span class="n">write</span>
<span class="o">*</span> <span class="n">API</span>      <span class="o">-&gt;</span>        <span class="n">wrapper</span> <span class="n">function</span>                      <span class="o">-&gt;</span>                <span class="n">ABI</span>                  <span class="o">-&gt;</span>  <span class="n">kernel</span> <span class="n">syscall</span></code></pre>
</div>
</div>
</li>
<li>
<p>Pasar los argumentos 1º-2º-3º-4º-5º-6º a través de los registros <em>EBX-ECX-EDX-ESI-EDI-EBP</em> en el orden indicado en el prototipo de la función en C:</p>
</li>
<li>
<p>Ej: llamada a la <em>syscall exit</em> del kernel desde un módulo fuente en lenguaje ASM:</p>
<div class="ulist">
<ul>
<li>
<p><code>man 3 exit</code></p>
</li>
<li>
<p><code>syscall(exit_code,int status)</code></p>
</li>
<li>
<p>módulo asm</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="nasm"><span class="nf">mov</span> <span class="kc">$</span><span class="mi">1</span><span class="p">,</span><span class="o">%</span><span class="nb">eax</span>
<span class="nf">mov</span> <span class="kc">$</span><span class="nv">status_value</span><span class="p">,</span><span class="o">%</span><span class="nb">ebx</span>
<span class="nf">int</span> <span class="kc">$</span><span class="mh">0x80</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Ej: llamada a la <em>syscall write</em> del kernel desde un módulo fuente en lenguaje ASM:</p>
<div class="ulist">
<ul>
<li>
<p><code>man 2 write</code></p>
</li>
<li>
<p><code>syscall(write_code,int fd, const void *buf, size_t count)</code></p>
</li>
<li>
<p>módulo asm</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="nasm"><span class="nf">mov</span> <span class="kc">$</span><span class="mi">4</span><span class="p">,</span><span class="o">%</span><span class="nb">eax</span>
<span class="nf">mov</span> <span class="kc">$</span><span class="mi">1</span><span class="p">,</span><span class="o">%</span><span class="nb">ebx</span>
<span class="nf">mov</span> <span class="kc">$</span><span class="nv">buffer_address_label</span><span class="p">,</span><span class="o">%</span><span class="nb">ecx</span>
<span class="nf">mov</span> <span class="nb">si</span><span class="nv">ze</span><span class="p">,</span><span class="o">%</span><span class="nb">edx</span>
<span class="nf">int</span> <span class="kc">$</span><span class="mh">0x80</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Valor de Retorno</p>
<div class="ulist">
<ul>
<li>
<p>El valor de retorno se pasa a través del registro <em>EAX</em></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_llamadas_a_las_funciones_de_la_librería_standard_de_c">LLamadas a las funciones de la librería standard de C</h5>
<div class="ulist">
<ul>
<li>
<p>Desde ASM se puede llamar a las funciones de la librería de C instalada en linux: <em>libc</em></p>
</li>
<li>
<p>Para llamar a la función <em>printf()</em> utilizamos la instrucción <code>call printf</code></p>
</li>
<li>
<p>Los argumentos de la función se pasan previamente a la llamada.</p>
<div class="ulist">
<ul>
<li>
<p>Los argumentos se pasan a través de la <strong>pila</strong> en el sentido Dcha&#8594;Izda a como estan definidos.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Es necesario linkar el módulo objeto con la librería <em>libc</em></p>
</li>
<li>
<p>Ej:</p>
<div class="ulist">
<ul>
<li>
<p>Programación C</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c"><span class="n">planetas</span> <span class="o">=</span> <span class="mi">9</span><span class="p">;</span>
<span class="n">printf</span><span class="p">(</span><span class="s">"El número de planetas es %d </span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">planetas</span><span class="p">);</span></code></pre>
</div>
</div>
</li>
<li>
<p>Programación ASM</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="nasm">     <span class="nf">.section</span> <span class="nv">.data</span>
<span class="nl">cadena:</span>
     <span class="nf">.asciz</span> <span class="err">"</span><span class="nv">El</span> <span class="nv">n</span><span class="err">ú</span><span class="nv">mero</span> <span class="nv">de</span> <span class="nv">planetas</span> <span class="nb">es</span> <span class="o">%</span><span class="nv">d</span> <span class="err">\</span><span class="nv">n</span><span class="err">"</span>
<span class="nl">planetas:</span>
     <span class="nf">.long</span> <span class="mi">0</span>
     <span class="nf">.section</span> <span class="nv">.text</span>
<span class="nl">_start:</span>
     <span class="nf">movl</span> <span class="kc">$</span><span class="mi">9</span><span class="p">,</span><span class="nv">planetas</span>
     <span class="nf">push</span> <span class="nv">planetas</span>
     <span class="nf">push</span> <span class="kc">$</span><span class="nv">cadena</span>
     <span class="nf">call</span> <span class="nv">printf</span>
     <span class="nf">call</span> <span class="nv">exit</span>
     <span class="nf">.end</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_línea_de_comandos">Línea de comandos</h5>
<div class="ulist">
<ul>
<li>
<p>Process Initialization</p>
</li>
<li>
<p>en el kernel está declarada la función main(): <code>extern int main (int argc , char* argv[] , char* envp[]) ;</code></p>
<div class="ulist">
<ul>
<li>
<p>declaración y definición del módulo principal</p>
</li>
<li>
<p><em>argc</em> is a non-negative argument count;</p>
</li>
<li>
<p><em>argv</em> is an array of argument strings, with argv[argc]==0;</p>
</li>
<li>
<p><em>envp</em> is an array of environment strings, also terminated by a null pointer.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Stack Initialization</p>
<table class="tableblock frame-all grid-all" style="width: 50%;">
<caption class="title">Table 13. Convenio ABI: Stack</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Stack Reference</th>
<th class="tableblock halign-center valign-top">Interpretation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">arguments strings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4n(%esp)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">- pointer to nº string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8(%esp)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">- pointer to 2º argument string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4(%esp)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">- pointer to 1º argument string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0(%esp)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">- argc</p></td>
</tr>
</tbody>
</table>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ejemplo_3">6.9.5. Ejemplo</h4>
<div class="ulist">
<ul>
<li>
<p>Introducir los datos del programa suma.s a través de 	a línea de comandos</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="scala"><span class="o">##</span><span class="k">#</span> <span class="n">función</span><span class="k">:</span> <span class="kt">sumar</span> <span class="kt">dos</span> <span class="kt">números</span> <span class="kt">enteros</span> <span class="kt">de</span> <span class="kt">un</span> <span class="kt">dígito.</span>
<span class="k">###</span>          <span class="kt">los</span> <span class="kt">sumandos</span> <span class="kt">se</span> <span class="kt">pasan</span> <span class="kt">a</span> <span class="kt">través</span> <span class="kt">de</span> <span class="kt">la</span> <span class="kt">línea</span> <span class="kt">de</span> <span class="kt">comandos</span>
        <span class="o">#</span><span class="k">#</span> <span class="n">gcc</span> <span class="o">-</span><span class="n">m32</span> <span class="o">-</span><span class="n">nostartfiles</span> <span class="o">-</span><span class="n">g</span> <span class="o">-</span><span class="n">o</span> <span class="n">sum_input</span> <span class="nv">sum_imput</span><span class="o">.</span><span class="py">s</span>
        <span class="o">#</span><span class="k">#</span> <span class="n">run</span> <span class="mi">5</span> <span class="mi">7</span>
        <span class="o">#</span><span class="k">#</span>  <span class="n">x</span> <span class="o">/</span><span class="nf">a</span>  <span class="o">(</span><span class="n">char</span><span class="o">**)(</span><span class="nc">$esp</span><span class="o">+</span><span class="mi">4</span><span class="o">)</span>  <span class="o">-&gt;</span> <span class="mh">0xffffd0a4</span><span class="k">:</span>	<span class="err">0</span><span class="kt">xffffd26e</span>
        <span class="o">#</span><span class="k">#</span>  <span class="n">x</span> <span class="o">/</span><span class="n">c</span>  <span class="o">*(</span><span class="n">char</span><span class="o">**)(</span><span class="nc">$esp</span><span class="o">+</span><span class="mi">4</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="mh">0xffffd26e</span><span class="k">:</span>	<span class="err">47</span> <span class="kt">'/'</span>
        <span class="k">##</span>  <span class="kt">x</span> <span class="kt">/s</span>  <span class="kt">*</span><span class="o">(</span><span class="kt">char**</span><span class="o">)(</span><span class="kt">$esp+</span><span class="err">4</span><span class="o">)</span> <span class="kt">-&gt;</span> <span class="err">0</span><span class="kt">xffffd26e:</span>	 <span class="err">"</span><span class="kt">/home/candido/tutoriales/as_tutorial/algoritmos_x86-</span><span class="err">32</span><span class="kt">/basicos/sum_input</span><span class="err">"</span>
        <span class="k">##</span>  <span class="kt">p</span> <span class="kt">/s</span> <span class="kt">*</span><span class="o">(</span><span class="kt">char**</span><span class="o">)(</span><span class="kt">$esp+</span><span class="err">4</span><span class="o">)</span>  <span class="kt">-&gt;</span> <span class="err">0</span><span class="kt">xffffd26e</span> <span class="err">"</span><span class="kt">/home/candido/tutoriales/as_tutorial/algoritmos_x86-</span><span class="err">32</span><span class="kt">/basicos/sum_input</span><span class="err">"</span>
        <span class="k">##</span>  <span class="kt">x</span> <span class="kt">/s</span>  <span class="kt">*</span><span class="o">(</span><span class="kt">char**</span><span class="o">)(</span><span class="kt">$esp+</span><span class="err">8</span><span class="o">)</span> <span class="kt">-&gt;</span> <span class="err">0</span><span class="kt">xffffd2b7:</span>	 <span class="err">"5"</span>
        <span class="k">##</span>  <span class="kt">x</span> <span class="kt">/s</span>  <span class="kt">*</span><span class="o">(</span><span class="kt">char**</span><span class="o">)(</span><span class="kt">$esp+</span><span class="err">12</span><span class="o">)</span> <span class="kt">-&gt;</span> <span class="err">0</span><span class="kt">xffffd2b9:</span>	 <span class="err">"7"</span>

        <span class="kt">.section</span> <span class="kt">.text</span>
	<span class="o">.</span><span class="py">globl</span> <span class="nc">_start</span>
<span class="nc">_start</span><span class="k">:</span>

        <span class="k">##</span> <span class="kt">instrucciones</span> <span class="kt">aclaratorias</span>

	<span class="n">leal</span> <span class="mi">8</span><span class="o">(%</span><span class="n">esp</span><span class="o">),%</span><span class="n">eax</span>       <span class="k">#</span><span class="n">eax</span> <span class="n">contiene</span> <span class="n">argv</span><span class="o">[</span><span class="err">1</span><span class="o">]</span> <span class="n">la</span> <span class="n">dirección</span> <span class="n">de</span> <span class="n">la</span> <span class="n">pila</span> <span class="n">que</span> <span class="n">contiene</span> <span class="n">el</span> <span class="n">pointer</span> <span class="n">al</span> <span class="n">argumento</span> <span class="n">string</span>
        <span class="n">movl</span> <span class="mi">8</span><span class="o">(%</span><span class="n">esp</span><span class="o">),%</span><span class="n">ebx</span>       <span class="k">#</span><span class="n">ebx</span> <span class="n">tiene</span> <span class="n">el</span> <span class="n">contendio</span> <span class="n">de</span> <span class="n">la</span> <span class="n">pila</span><span class="k">=</span> <span class="n">dirección</span> <span class="n">del</span> <span class="n">string</span>
        <span class="n">xor</span> <span class="o">%</span><span class="n">ecx</span><span class="o">,%</span><span class="n">ecx</span>
        <span class="nf">movb</span> <span class="o">(%</span><span class="n">ebx</span><span class="o">),%</span><span class="n">cl</span>        <span class="k">#</span><span class="n">caracter</span> <span class="nc">ASCII</span>

        <span class="o">#</span><span class="k">#</span> <span class="n">string</span> <span class="n">argument</span> <span class="n">pointers</span>
        <span class="n">movl</span> <span class="mi">8</span><span class="o">(%</span><span class="n">esp</span><span class="o">),%</span><span class="n">eax</span>       <span class="k">#</span><span class="n">eax</span> <span class="n">tiene</span> <span class="n">el</span> <span class="n">contendio</span> <span class="n">de</span> <span class="n">la</span> <span class="n">pila</span><span class="k">=</span> <span class="n">dirección</span> <span class="n">del</span> <span class="n">string</span><span class="o">.</span> <span class="n">argv</span><span class="o">[</span><span class="err">1</span><span class="o">]</span>
        <span class="n">movl</span> <span class="mi">12</span><span class="o">(%</span><span class="n">esp</span><span class="o">),%</span><span class="n">ebx</span>       <span class="k">#</span><span class="n">eax</span> <span class="n">tiene</span> <span class="n">el</span> <span class="n">contendio</span> <span class="n">de</span> <span class="n">la</span> <span class="n">pila</span><span class="k">=</span> <span class="n">dirección</span> <span class="n">del</span> <span class="n">string</span><span class="o">.</span> <span class="n">argv</span><span class="o">[</span><span class="err">2</span><span class="o">]</span>
        <span class="o">#</span><span class="k">#</span> <span class="n">fetch</span> <span class="n">string</span> <span class="n">indirect</span>
        <span class="o">#</span><span class="k">#</span> <span class="n">convert</span> <span class="n">ascii</span> <span class="n">numbers</span> <span class="n">to</span> <span class="n">values</span>
        <span class="n">xor</span> <span class="o">%</span><span class="n">ecx</span><span class="o">,%</span><span class="n">ecx</span>
        <span class="n">xor</span> <span class="o">%</span><span class="n">edx</span><span class="o">,%</span><span class="n">edx</span>
        <span class="nf">movb</span> <span class="o">(%</span><span class="n">eax</span><span class="o">),%</span><span class="n">cl</span>         <span class="k">#</span> <span class="n">indirección</span> <span class="n">para</span> <span class="n">acceder</span> <span class="n">al</span> <span class="n">string</span> <span class="n">referenciado</span> <span class="n">por</span> <span class="n">argv</span><span class="o">[</span><span class="err">1</span><span class="o">]</span>
        <span class="nf">movb</span> <span class="o">(%</span><span class="n">ebx</span><span class="o">),%</span><span class="n">dl</span>         <span class="k">#</span> <span class="n">indirección</span> <span class="n">para</span> <span class="n">acceder</span> <span class="n">al</span> <span class="n">string</span> <span class="n">referenciado</span> <span class="n">por</span> <span class="n">argv</span><span class="o">[</span><span class="err">1</span><span class="o">]</span>
        <span class="n">subl</span> <span class="n">$0x30</span><span class="o">,%</span><span class="n">ecx</span>
        <span class="n">subl</span> <span class="n">$0x30</span><span class="o">,%</span><span class="n">edx</span>

        <span class="n">push</span> <span class="o">%</span><span class="n">ecx</span>
        <span class="n">push</span> <span class="o">%</span><span class="n">edx</span>

        <span class="n">call</span> <span class="n">suma</span>

	<span class="o">#</span><span class="k">#</span> <span class="n">salida</span>
        <span class="n">movl</span> <span class="o">%</span><span class="n">eax</span><span class="o">,%</span><span class="n">ebx</span>
	<span class="n">movl</span>  <span class="n">$1</span><span class="o">,</span> <span class="o">%</span><span class="n">eax</span>	    <span class="k">#</span><span class="mi">1</span> <span class="n">is</span> <span class="n">the</span> <span class="nf">exit</span><span class="o">()</span> <span class="n">syscall</span>
	<span class="n">int</span>   <span class="n">$0x80</span>


<span class="o">##</span><span class="k">#</span> <span class="nc">Función</span> <span class="n">que</span> <span class="n">calcula</span> <span class="n">el</span> <span class="n">máximo</span> <span class="n">entre</span> <span class="n">dos</span> <span class="n">valores</span>
	<span class="o">.</span><span class="py">type</span> <span class="n">suma</span><span class="o">,</span> <span class="nd">@function</span>
	<span class="o">.</span><span class="py">section</span> <span class="o">.</span><span class="py">text</span>
<span class="n">suma</span><span class="k">:</span>
	<span class="k">##</span> <span class="kt">prologo</span>
	<span class="n">push</span> <span class="o">%</span><span class="n">ebp</span>
	<span class="n">movl</span> <span class="o">%</span><span class="n">esp</span><span class="o">,%</span><span class="n">ebp</span>
	<span class="n">subl</span> <span class="n">$1</span><span class="o">,%</span><span class="n">esp</span>            <span class="k">#</span><span class="n">reserva</span> <span class="n">de</span> <span class="n">memoria</span>
	<span class="n">push</span> <span class="o">%</span><span class="n">ebx</span>
	<span class="n">push</span> <span class="o">%</span><span class="n">edi</span>
	<span class="n">push</span> <span class="o">%</span><span class="n">esi</span>
	<span class="o">#</span><span class="k">#</span> <span class="n">captura</span> <span class="n">de</span> <span class="n">argumentos</span>
	<span class="n">movl</span> <span class="mi">8</span><span class="o">(%</span><span class="n">ebp</span><span class="o">),%</span><span class="n">eax</span>      <span class="k">#</span><span class="mi">1</span><span class="n">º</span> <span class="n">argumento</span>
	<span class="n">movl</span> <span class="mi">12</span><span class="o">(%</span><span class="n">ebp</span><span class="o">),%</span><span class="n">ecx</span>     <span class="k">#</span><span class="mi">2</span><span class="n">º</span> <span class="n">argumento</span>
	<span class="o">#</span><span class="k">#</span> <span class="n">cuerpo</span>
	<span class="n">addl</span> <span class="o">%</span><span class="n">ecx</span><span class="o">,%</span><span class="n">eax</span>          <span class="k">#</span>
	<span class="o">#</span><span class="k">#</span> <span class="n">guardar</span> <span class="n">resultado</span>

	<span class="o">#</span><span class="k">#</span> <span class="n">el</span> <span class="n">resultado</span> <span class="n">está</span> <span class="n">en</span> <span class="nc">EAX</span>
	<span class="o">#</span><span class="k">#</span> <span class="n">epilogo</span>
	<span class="n">pop</span> <span class="o">%</span><span class="n">esi</span>
	<span class="n">pop</span> <span class="o">%</span><span class="n">edi</span>
	<span class="n">pop</span> <span class="o">%</span><span class="n">ebx</span>
	<span class="n">mov</span> <span class="o">%</span><span class="n">ebp</span><span class="o">,%</span><span class="n">esp</span>           <span class="k">#</span> <span class="n">frame</span> <span class="n">anterior</span>
	<span class="n">pop</span> <span class="o">%</span><span class="n">ebp</span>
	<span class="n">ret</span>                     <span class="k">#</span> <span class="n">recuperar</span> <span class="n">dirección</span> <span class="n">de</span> <span class="n">retorno</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph nav-footer">
<p>← Previous: <a href="_representación_de_las_instrucciones.html">Representación de las Instrucciones</a> | ↑ Up: <a href="_i_arquitectura_del_repertorio_de_instrucciones_isa_computadora_von_neumann_datos_instrucciones_programación.html">I Arquitectura del Repertorio de Instrucciones (ISA): computadora von Neumann, datos, instrucciones, programación.</a> | ⌂ Home: <a href="eecc_book.html">Estructura de Computadores  (240306)</a> | Next: <a href="_ii_unidades_básicas_procesador_central_unidad_de_memoria_mecanismos_entradasalida.html">II Unidades Básicas: Procesador Central, Unidad de Memoria, Mecanismos Entrada/Salida.</a> →</p>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-09-14 15:29:34 +0200
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>