<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<meta name="keywords" content="computer, architecture">
<meta name="author" content="Cándido Aramburu">
<title>Estructura de Computadores  (240306)</title>
<style>
@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";
@import "https://cdn.jsdelivr.net/gh/asciidoctor/asciidoctor@2.0/data/stylesheets/asciidoctor-default.css";



h1, h2, h3, h4, h5, h6, #toctitle,
.sidebarblock > .content > .title {
  color: rgba(221, 72, 20, 0.8);
}



</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<!-- Change some CSS.
<style>
.imageblock{
  &.text-center > .title {
    text-align: center !important;
  }
}
</style>

-->

<style type="text/css"> .imageblock > .title { text-align: center; } </style>

<style>.toc-current{font-weight: bold;} .toc-root{font-family: "Open Sans","DejaVu Sans",sans-serif;
                       font-size: 0.9em;} #content{display: flex; flex-direction: column; flex: 1 1 auto;}
             .nav-footer{text-align: center; margin-top: auto;}
             .nav-footer > p > a {white-space: nowrap;}</style>
</head>
<body id="_instrucciones_de_saltos_condicionales" class="book">
<div id="header">
<h1>Estructura de Computadores  (240306)</h1>
<div class="details">
<span id="author" class="author">Cándido Aramburu</span><br>
<span id="email" class="email"><a href="mailto:candido@unavarra.es">candido@unavarra.es</a></span><br>
<span id="revdate">2022-12-14</span>
</div>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<p><span class="toc-root"><a href="eecc_book.html">Estructura de Computadores  (240306)</a></span></p><ul class="sectlevel0">
<li><a href="_i_arquitectura_del_repertorio_de_instrucciones_isa_computadora_von_neumann_datos_instrucciones_programación.html">I Arquitectura del Repertorio de Instrucciones (ISA): computadora von Neumann, datos, instrucciones, programación.</a>
</li>
<li><a href="_ii_unidades_básicas_procesador_central_unidad_de_memoria_mecanismos_entradasalida.html">II Unidades Básicas: Procesador Central, Unidad de Memoria, Mecanismos Entrada/Salida.</a>
</li>
<li><a href="_iii_ejercicios_de_teoría.html">III Ejercicios de Teoría</a>
</li>
<li><a href="_iv_autoevaluación_teoría.html">IV Autoevaluación Teoría</a>
</li>
<li><a href="_v_guiones_de_prácticas_programación_ensamblador_x86.html">V Guiones de Prácticas: Programación Ensamblador x86</a>
<ul class="sectlevel1">
<li><a href="_introducción_a_la_programación_en_lenguaje_ensamblador_att_x86_32.html">12. Introducción a la Programación en Lenguaje Ensamblador AT&amp;T x86-32</a>
</li>
<li><a href="_representación_de_los_datos_2.html">13. Representación de los Datos</a>
</li>
<li><a href="_operaciones_aritméticas_y_lógicas.html">14. Operaciones Aritméticas y Lógicas</a>
</li>
<li><a href="_instrucciones_de_saltos_condicionales.html"><span class="toc-current">15. Instrucciones de Saltos Condicionales</span></a>
<ul class="sectlevel2">
<li><a href="_instrucciones_de_saltos_condicionales.html#_introducción_20">15.1. Introducción</a>
<ul class="sectlevel3">
<li><a href="_instrucciones_de_saltos_condicionales.html#_objetivos_6">15.1.1. Objetivos</a>
</li>
<li><a href="_instrucciones_de_saltos_condicionales.html#_requisitos_6">15.1.2. Requisitos</a>
</li>
</ul>
</li>
<li><a href="_instrucciones_de_saltos_condicionales.html#_leeme_4">15.2. LEEME</a>
</li>
<li><a href="_instrucciones_de_saltos_condicionales.html#_cuestiones_4">15.3. Cuestiones</a>
</li>
<li><a href="_instrucciones_de_saltos_condicionales.html#_saltos_condicionales">15.4. Saltos Condicionales</a>
<ul class="sectlevel3">
<li><a href="_instrucciones_de_saltos_condicionales.html#_algoritmo_4">15.4.1. Algoritmo</a>
</li>
<li><a href="_instrucciones_de_saltos_condicionales.html#_edición_del_módulo_fuente_saltos_s">15.4.2. Edición del Módulo fuente: saltos.s</a>
</li>
<li><a href="_instrucciones_de_saltos_condicionales.html#_compilación_7">15.4.3. Compilación</a>
</li>
<li><a href="_instrucciones_de_saltos_condicionales.html#_ejecución_7">15.4.4. Ejecución</a>
</li>
<li><a href="_instrucciones_de_saltos_condicionales.html#_análisis_del_módulo_fuente_4">15.4.5. Análisis del módulo fuente</a>
</li>
<li><a href="_instrucciones_de_saltos_condicionales.html#_ejecución_paso_a_paso_3">15.4.6. Ejecución paso a paso</a>
</li>
</ul>
</li>
<li><a href="_instrucciones_de_saltos_condicionales.html#_mnemónicos_utilizados">15.5. Mnemónicos Utilizados</a>
</li>
</ul>
</li>
<li><a href="_llamadas_al_sistema_operativo_kernel.html">16. LLamadas al Sistema Operativo (Kernel)</a>
</li>
<li><a href="_subrutinas_2.html">17. Subrutinas</a>
</li>
<li><a href="_imágenes_bit_map_portable.html">18. Imágenes: Bit Map Portable</a>
</li>
</ul>
</li>
<li><a href="_vi_hojas_de_referencia_rápida.html">VI Hojas de Referencia Rápida</a>
</li>
<li><a href="_vii_autoevaluación_prácticas.html">VII Autoevaluación Prácticas</a>
</li>
<li><a href="_viii_apéndices.html">VIII Apéndices</a>
</li>
<li><a href="_ix_bibliografía.html">IX Bibliografía</a>
</li>
<li><a href="_x_glosario.html">X Glosario</a>
</li>
<li><a href="_xi_colofón.html">XI Colofón</a>
</li>
<li><a href="_index.html">Index</a>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_instrucciones_de_saltos_condicionales">15. Instrucciones de Saltos Condicionales</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introducción_20">15.1. Introducción</h3>
<div class="sect3">
<h4 id="_objetivos_6">15.1.1. Objetivos</h4>
<div class="ulist">
<ul>
<li>
<p>Manejo del registro de flags, instrucciones de comparación y saltos condicionales  para su aplicación en sentencias de lenguajes de alto nivel tipo if, for, while, switch-case.</p>
</li>
<li>
<p>Depurador GDB</p>
<div class="ulist">
<ul>
<li>
<p>Uso del comando <code>watch</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_requisitos_6">15.1.2. Requisitos</h4>
<div class="ulist">
<ul>
<li>
<p>Teoría: representación de datos, operaciones aritméticas y lógicas, formato de instrucciones y repertorio  ISA de la arquitectura X86.</p>
</li>
<li>
<p>Práctica anterior: Introducción a la programación en lenguaje ensamblador AT&amp;T x86-32</p>
</li>
<li>
<p>Conceptos del lenguaje de programación C: if, for, while, switch-case</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_leeme_4">15.2. LEEME</h3>
<div class="ulist">
<ul>
<li>
<p>Lectura del guión de prácticas  y del capítulo 3 del Libro Programming from the Ground-Up.</p>
</li>
<li>
<p><a href="_practicando_la_programación_desde_el_principio.html#prac_apu">Apuntes y Libro de Texto</a></p>
</li>
<li>
<p><a href="_practicando_la_programación_desde_el_principio.html#prac_doc_mem">Documentación Memoria</a>: Contenido y Formato de la Memoria</p>
</li>
<li>
<p><a href="_practicando_la_programación_desde_el_principio.html#prac_eval">Evaluación</a>: sistema de evaluación</p>
</li>
<li>
<p><a href="_practicando_la_programación_desde_el_principio.html#prac_plat_des">Plataforma de Desarrollo</a> : configuración de la computadora personal</p>
</li>
<li>
<p><a href="_practicando_la_programación_desde_el_principio.html#prac_prog">Programación</a> : metodología</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_cuestiones_4">15.3. Cuestiones</h3>
<div class="ulist">
<ul>
<li>
<p><a href="_practicando_la_programación_desde_el_principio.html#prac_eval">"Autoevaluación de Prácticas"</a> opcional: <a href="_prácticas_cuestionario.html#prac_cues">Prácticas: Cuestionario</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_saltos_condicionales">15.4. Saltos Condicionales</h3>
<div class="sect3">
<h4 id="_algoritmo_4">15.4.1. Algoritmo</h4>
<div class="ulist">
<ul>
<li>
<p>No se desarrolla ningún algoritmo. Son instrucciones para la práctica de los saltos condicionales.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_edición_del_módulo_fuente_saltos_s">15.4.2. Edición del Módulo fuente: saltos.s</h4>
<div class="ulist">
<ul>
<li>
<p>Descargar el módulo fuente "saltos.s" de miaulario y añadir los comentarios apropiados.</p>
<div class="listingblock">
<div class="content">
<pre>/*
Programa:     datos_saltos.s
Descripción: Emplear estructuras de datos con diferentes direccionamientos
### Compilación: gcc -m32 -g -o datos_saltos datos_saltos.s

*/

	## MACROS
	.equ SYS_EXIT,	1
	.equ SUCCESS,	0

	## VARIABLES LOCALES
	.data


	## INSTRUCCIONES
	.global main
	.text
main:

	## RESET

	xor  %eax,%eax
	xor  %ebx,%ebx
	xor  %ecx,%ecx
	xor  %edx,%edx
	xor  %esi,%esi
        xor  %edi,%edi

	## SALTOS INCONDICIONALES

	## Direccionamiento relativo
	jmp salto1		#salto relativo al contador de programa pc -&gt; eip
	xor %esi,%esi

	## FLAGS DEL REGISTRO DE BANDERINES EFLAGS
	/*
	los flags se activan al realizar operaciones aritméticas, lógicas, etc dependiendo del resultado de dicha operación
CF: El resultado de la operación tiene llevada del bit MSB del destino
OF: El resultado de la operación con signo se  desborda, su tamaño supera el permitido.
ZF: el resultado de la operación  tiene  valor  cero
SF: el resultado de la oeración tiene valor  negativo
PF: el resultado de la operación tiene el byte LSB con un  número par de bits
	*/
salto1:
	xor %eax,%eax	       # resultado cero -&gt; activa ZF y PF pero desactiva CF,OF,SF
	inc %eax	       # desactiva ZF y PF
	neg %eax	       # activa SF,PF y CF : realiza la resta de la definición de complemento a 2 :(0-N)
	shr $1,%eax	       # SHift Right : desplazamiento lógico: desplaza n bits el operando destino.
/* Salen bits por la dcha y entran ceros por la izda.
 El último bit salido queda en CF.
 SF=0 ya que ha entrado un cero en el MSB
 MANUAL INTEL: http://www.cs.nyu.edu/~mwalfish/classes/ut/s13-cs439/ref/i386/SAL.htm
 For SHR, OF is set to the high-order bit of the original operand.
	OF=MSB=1
 The OF flag is affected only on 1-bit shifts.
 Equivale a dividir 2^n si desplazo a la dcha y a multiplicar 2^n hacia la izda (posible overflow).
*/
	shl $1,%eax
	clc		       # clear CF -&gt; CF=0
	xor %eax,%eax	       # resultado cero -&gt; activa ZF y PF pero desactiva CF,OF,SF
	movw $0xFFFF,%ax       # MOV NO afecta a ningún flag
	addw $0xFFFF,%ax	# activa SF y CF pero no OF
	clc
	movw $0x7FFF,%ax
	addw $1,%ax		#activa OF pero no CF, OF avisa del error en la suma y se puede ver que SF se ha activado


	## INSTRUCCIONES COMPARATIVAS: TEST,CMP

	## Comprobar si el bit de la posicion 5  es cero con la mascara 0x0010 que aisla dicha posicion
	## test realiza la operación AND afectando a los flags de EFLAGS pero no guarda el resultado en el operando destino
	movw $0xABFF, %ax
	movw $0x0BCF, %bx
	test $0x0010, %ax	# AX^0x0010=0x0010=positivo -&gt; SF=0, low byte=0x10 impar -&gt; PF=0,
				# El manual dice -&gt; The OF and CF flags are cleared
        test $0xFFFF, %ax	# SF=1 porque AX^0xFFFF=AX= negativo, low byte=AL= par -&gt;  PF=1
	test $0b0000000000010000, %bx	# SF=0 porque AX^0x0010=positivo ,ZF=1 porque BX[5] es cero, PF=0

	## Comprobar si el valor de una variable es mayor, menor o igual al valor 0x00FF
	## cmp realiza la operacion SUB afectando a los flags de EFLAGS pero no guarda el resultado en el operando destino
	## SUB: It evaluates the result for both signed and unsigned integer operands and sets the OF and CF flags
	## to indicate an overflow in the signed or unsigned result, respectively
	movw $0x01FF, %ax
	movw $0x0001, %bx
	movw $0x00FF, %cx
	cmp  $0x00FF, %ax	#  AX-0x00FF=0x0100 &gt; 0 -&gt;  ZF=0 y SF=0, low byte=00 -&gt; PF=1
	cmp  $0x00FF, %bx	#  BX-0x00FF=0x0001+0xFF01=0xFF02 &lt; 0 -&gt; SF=1, 0x02 impar -&gt; PF=0,
				#  unsigned overflow -&gt; CF=1, signed not overflow OF=0
	cmp  $0x00FF, %cx	#  CX-0x00FF=0 -&gt; ZF=1, SF=0, 0xFF par PF=1, CF=0, OF=0

	## SALTOS CONDICIONALES

	movw $0x01FF, %ax
	movw $0x0001, %bx
	movw $0x00FF, %cx
	cmp  $0x00FF, %ax	#  AX-0x00FF=0x0100 &gt; 0, luego ZF=0 y SF=0, 0x00 para -&gt; PF=1
	jg   salto4		# great jump -&gt; resta de numeros con signo -&gt; SF=0 y salta
	nop
salto4:	cmp  $0x00FF, %bx	# BX-0x00FF=0x0001+0xFF01=0xFF02 &lt; 0, luego ZF=0 , SF=1,
				# unsigned over CF=1 y not signed over OF=0
	jl   salto5		# less jump -&gt; resta de numeros con signo -&gt; SF=1 y salta
	nop
salto5:	movw $0x8000, %ax	# 0x8000 vale -32768 con signo y 32768 sin signo
	cmp  $0x0001, %ax	# Con signo -&gt;0x8000 - 0x1 = 0x8000+0xFFFF=0x7FFFF &gt;0 -&gt; SF=0,
				# OF=1 ya que la suma de dos negativos ha dado positivo
                                # CF=0 ya que en binario puro 0x01FF-0x00001=0x01FE, no overflow
				# 0xFF es par -&gt; PF=1

	ja   salto6		# above jump -&gt; resta de números sin signo -&gt; 32768-1&gt;0
	nop
salto6:	cmp  $0x00FF, %cx	# CX-0x00FF = 0, luego ZF=1 y SF=0
	je   salto7		# equal jump
	nop


	## SALIDA

salto7:	mov $SYS_EXIT, %eax
	mov $SUCCESS,  %ebx
	int $0x80

	.end</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_compilación_7">15.4.3. Compilación</h4>
<div class="ulist">
<ul>
<li>
<p>Seguir los pasos del proceso de <a href="_practicando_la_programación_desde_el_principio.html#compilacion">compilación</a> común a todas las sesiones.</p>
<div class="ulist">
<ul>
<li>
<p><code>gcc  -m32 -g -o saltos saltos.s</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_ejecución_7">15.4.4. Ejecución</h4>
<div class="ulist">
<ul>
<li>
<p><code>./saltos</code></p>
</li>
<li>
<p><code>echo $?</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_análisis_del_módulo_fuente_4">15.4.5. Análisis del módulo fuente</h4>
<div class="ulist">
<ul>
<li>
<p>Leer en las hojas de referencia rápida el <a href="_programación_ensamblador_att_x86.html#programa_minimalista">Programa Ejemplo Minimalista</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_estructura_2">Estructura</h5>
<div class="ulist">
<ul>
<li>
<p>La estructura del programa esta formada por los siguientes elementos:</p>
<div class="ulist">
<ul>
<li>
<p>Cabecera</p>
</li>
<li>
<p>Definición de Macros</p>
</li>
<li>
<p>Sección de Datos</p>
</li>
<li>
<p>Sección de Instrucciones</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ejecución_paso_a_paso_3">15.4.6. Ejecución paso a paso</h4>
<div class="sect4">
<h5 id="_operaciones_iniciales">Operaciones Iniciales</h5>
<div class="ulist">
<ul>
<li>
<p>Compilar el programa con la opción de generación de la tabla de símbolos requerida por el depurador y generar el módulo binario ejecutable:</p>
<div class="ulist">
<ul>
<li>
<p><code>gcc -m32 -g  -o saltos saltos.s</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Abrir el depurador GDB, cargar el módulo binario ejecutable y comprobar que se carga la tabla de símbolos junto al módulo binario ejecutable.</p>
<div class="ulist">
<ul>
<li>
<p><code>gdb</code></p>
</li>
<li>
<p><code>file saltos</code></p>
</li>
<li>
<p><code>info sources</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Configurar el fichero para el logging histórico de los comandos.</p>
<div class="ulist">
<ul>
<li>
<p><code>set trace-commands on</code></p>
</li>
<li>
<p><code>set logging file saltos_gdb_asm.txt</code></p>
</li>
<li>
<p><code>set logging on</code></p>
</li>
<li>
<p><code>shell ls -l saltos_gdb_asm.txt</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Activar un punto de ruptura en la instrucción de entrada al programa.</p>
<div class="ulist">
<ul>
<li>
<p><code>b _start</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Ejecutar el programa deteniéndolo en la primera instrucción del programa.</p>
<div class="ulist">
<ul>
<li>
<p><code>run</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_registro_eflags">Registro EFLAGS</h5>
<div class="ulist">
<ul>
<li>
<p><code>p $eflags</code> &#8594; imprime los nombres de los flags activos</p>
</li>
<li>
<p>comprobar el estado de los banderines con las operaciones lógicas, aritméticas y las instrucciones TEST y CMP.</p>
</li>
<li>
<p>Para el análisis de los banderines en modo paso a paso utilizar el comando <code>watch</code> del depurador GDB</p>
<div class="listingblock">
<div class="content">
<pre>(gdb) watch $eflags : interrumpe la ejecución y visualiza el contenido del registro EFLAGS cada vez que cambia su valor.
(gdb) info watch    : visualiza los watchs definidos
(gdb) delete breakpoints : elimina los breaks, watchs, etc</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_saltos_3">Saltos</h5>
<div class="ulist">
<ul>
<li>
<p>Comprobar la ejecución o no del salto con el estado e interpretación de los banderines del registro EFLAGS. Es un ejercicio de
interpretación de FLAGS &#8594; Cuando se ejecuta la instrucción de salto,  la CPU  tiene que tomar la decisión de saltar o  no interpretando los FLAGS. ¿ Sabríamos RELACIONAR la condición de <strong>ja</strong> (salto si ABOVE) leyendo los FLAGS y sin leer los valores de los operandos que se comparan en la condición ABOVE?</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_mnemónicos_utilizados">15.5. Mnemónicos Utilizados</h3>
<div class="ulist">
<ul>
<li>
<p>Ver capítulo  <a href="_programación_en_lenguaje_ensamblador_x86_construcciones_básicas_de_los_lenguajes_de_alto_nivel.html#mnemonicos_basicos_explicados">"Programación ensamblador : Mnemónicos Básicos (Explicados)"</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="paragraph nav-footer">
<p>← Previous: <a href="_operaciones_aritméticas_y_lógicas.html">Operaciones Aritméticas y Lógicas</a> | ↑ Up: <a href="_v_guiones_de_prácticas_programación_ensamblador_x86.html">V Guiones de Prácticas: Programación Ensamblador x86</a> | ⌂ Home: <a href="eecc_book.html">Estructura de Computadores  (240306)</a> | Next: <a href="_llamadas_al_sistema_operativo_kernel.html">LLamadas al Sistema Operativo (Kernel)</a> →</p>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-11-03 13:10:16 +0100
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>