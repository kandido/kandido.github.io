<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<meta name="keywords" content="computer, architecture">
<meta name="author" content="Cándido Aramburu">
<title>Estructura de Computadores  (240306)</title>
<style>
@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";
@import "https://cdn.jsdelivr.net/gh/asciidoctor/asciidoctor@2.0/data/stylesheets/asciidoctor-default.css";



h1, h2, h3, h4, h5, h6, #toctitle,
.sidebarblock > .content > .title {
  color: rgba(221, 72, 20, 0.8);
}



</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<!-- Change some CSS.
<style>
.imageblock{
  &.text-center > .title {
    text-align: center !important;
  }
}
</style>

-->

<style type="text/css"> .imageblock > .title { text-align: center; } </style>

<style>.toc-current{font-weight: bold;} .toc-root{font-family: "Open Sans","DejaVu Sans",sans-serif;
                       font-size: 0.9em;} #content{display: flex; flex-direction: column; flex: 1 1 auto;}
             .nav-footer{text-align: center; margin-top: auto;}
             .nav-footer > p > a {white-space: nowrap;}</style>
</head>
<body id="_formato_de_instrucción_isa_intel_x86_64_2" class="book">
<div id="header">
<h1>Estructura de Computadores  (240306)</h1>
<div class="details">
<span id="author" class="author">Cándido Aramburu</span><br>
<span id="email" class="email"><a href="mailto:candido@unavarra.es">candido@unavarra.es</a></span><br>
<span id="revdate">2022-09-04</span>
</div>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<p><span class="toc-root"><a href="eecc_book.html">Estructura de Computadores  (240306)</a></span></p><ul class="sectlevel0">
<li><a href="_i_arquitectura_del_repertorio_de_instrucciones_isa_computadora_von_neumann_datos_instrucciones_programación.html">I Arquitectura del Repertorio de Instrucciones (ISA): computadora von Neumann, datos, instrucciones, programación.</a>
</li>
<li><a href="_ii_unidades_básicas_procesador_central_unidad_de_memoria_mecanismos_entradasalida.html">II Unidades Básicas: Procesador Central, Unidad de Memoria, Mecanismos Entrada/Salida.</a>
</li>
<li><a href="_iii_ejercicios_de_teoría.html">III Ejercicios de Teoría</a>
</li>
<li><a href="_iv_autoevaluación_teoría.html">IV Autoevaluación Teoría</a>
</li>
<li><a href="_v_guiones_de_prácticas_programación_ensamblador_x86.html">V Guiones de Prácticas: Programación Ensamblador x86</a>
</li>
<li><a href="_vi_hojas_de_referencia_rápida.html">VI Hojas de Referencia Rápida</a>
</li>
<li><a href="_vii_autoevaluación_prácticas.html">VII Autoevaluación Prácticas</a>
</li>
<li><a href="_viii_apéndices.html">VIII Apéndices</a>
<ul class="sectlevel1">
<li><a href="_programas_ensamblador_iassim.html">21. Programas ensamblador IASSim</a>
</li>
<li><a href="_simulador_iassim_2.html">22. Simulador IASSim</a>
</li>
<li><a href="_lenguajes_de_programación_para_sum1ton.html">23. Lenguajes de programación para sum1toN</a>
</li>
<li><a href="_rtl_register_transfer_language.html">24. RTL Register Transfer Language</a>
</li>
<li><a href="_formato_de_instrucción_isa_intel_x86_64_2.html"><span class="toc-current">25. Formato de Instrucción: ISA Intel x86-64</span></a>
<ul class="sectlevel2">
<li><a href="_formato_de_instrucción_isa_intel_x86_64_2.html#form_inst">25.1. Formato de Instrucción: ISA Intel x86-64</a>
<ul class="sectlevel3">
<li><a href="_formato_de_instrucción_isa_intel_x86_64_2.html#_ejemplo_subq_16rsp">25.1.1. Ejemplo subq    $16,%rsp</a>
</li>
<li><a href="_formato_de_instrucción_isa_intel_x86_64_2.html#_otros_x86_32">25.1.2. Otros x86-32</a>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="_fpu_x87.html">26. FPU x87</a>
</li>
<li><a href="_pila.html">27. Pila</a>
</li>
<li><a href="_llamadas_al_sistema_operativo_2.html">28. Llamadas al Sistema Operativo</a>
</li>
<li><a href="_lenguaje_de_programación_c_2.html">29. Lenguaje de Programación C</a>
</li>
<li><a href="_apéndice_prácticas.html">30. Apéndice Prácticas</a>
</li>
<li><a href="_arquitectura_amd64_4.html">31. Arquitectura amd64</a>
</li>
<li><a href="_exámenes_de_cursos_anteriores.html">32. Exámenes de Cursos Anteriores</a>
</li>
<li><a href="_miaulario_videoconferencia.html">33. Miaulario: Videoconferencia</a>
</li>
</ul>
</li>
<li><a href="_ix_bibliografía.html">IX Bibliografía</a>
</li>
<li><a href="_x_glosario.html">X Glosario</a>
</li>
<li><a href="_xi_colofón.html">XI Colofón</a>
</li>
<li><a href="_index.html">Index</a>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_formato_de_instrucción_isa_intel_x86_64_2">25. Formato de Instrucción: ISA Intel x86-64</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="form_inst">25.1. Formato de Instrucción: ISA Intel x86-64</h3>
<div class="sect3">
<h4 id="_ejemplo_subq_16rsp">25.1.1. Ejemplo subq    $16,%rsp</h4>
<div class="ulist">
<ul>
<li>
<p>Ejemplo:</p>
<div class="ulist">
<ul>
<li>
<p>instrucción máquina intel x86.</p>
<div class="ulist">
<ul>
<li>
<p><strong>4001a4:       48 83 ec 10   &#8594;  subq    $16,%rsp</strong></p>
</li>
<li>
<p>¿Cómo interpretar la instrucción máquina  <strong>4883EC10</strong>? Es necesario consultar el <strong>Manual de Referencia de la Arquitectura ISA de la máquina x86</strong> y tener conocimientos de los modos de direccionamiento.</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="http://www.intel.com/content/www/us/en/processors/architectures-software-developer-manuals.html">manual oficial de intel x86 ó x86-64</a>: cuidado con la sintaxis intel.</p>
<div class="ulist">
<ul>
<li>
<p>consultar el volumen 2B (capítulo 4, pag 394)para la instrucción <em>SUB</em>. Hay que tener encuenta el tamaño de los operandos y los modos de direccionamiento.</p>
</li>
<li>
<p>El sufijo q de la operación <strong>SUBQ</strong> indica operando de 64 bits. El operando fuente <strong>$16</strong> es referenciado con direccionamiento inmediato y se puede codificar con 8 bits y el operando destino <strong>%RSP</strong> es un registro de 64 bits. Por lo tanto la descripcion intel en el manual será <strong>SUB r64, imm8</strong> que se corresponde con el código de operación <strong>REX.W + 83 /5 ib</strong>.</p>
</li>
<li>
<p>La descripción del código de operación que hace intel no es sencilla y es necesario consultar la Interpretación de la Instrucción en el <strong>volumen 3 3.1 INTERPRETING THE INSTRUCTION REFERENCE PAGES</strong> y el Formato de Instrucción en el <strong>volumen 2A (capítulo 2 Formato de Instrucción)</strong></p>
</li>
<li>
<p>Figura 2.1 Intel 64 and IA-32 Architectures Instruction Format</p>
</li>
<li>
<p>El formato de instrucción tiene los campos: <strong>REXprefix-CodOp-ModRB</strong> que en nuestro caso valen <strong>48-83-EC</strong></p>
<div class="ulist">
<ul>
<li>
<p>interpretación del campo REXprefix: <strong>REX.W</strong>: Manual &#8594; El prefijo REX se utiliza para operandos de 64 bits bien inmediatos y/o registros GlobalPurposeRegister(rax,rbx, etc), 2.2.1.2 More on REX Prefix Fields</p>
<div class="ulist">
<ul>
<li>
<p>El primer byte es <code>48</code> &#8594; <code>01001000</code> donde el bit de la posición 3 está activado por lo que según la tabla "Table 2-4. REX Prefix Fields [BITS: 0100WRXB]" quiere decir que el <strong>operando es de 64bits</strong></p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>/5</strong> : the ModR/M byte of the instruction uses only the r/m (register or memory) operand. <strong>En este caso register</strong>.Ver el subcampo R/M más abajo.</p>
</li>
<li>
<p><strong>ib</strong> : A 1-byte (ib) immediate operand.</p>
</li>
<li>
<p>Campo Primary Opcode: El segundo byte vale <code>83</code> &#8594; Operación de resta <strong>SUB</strong></p>
</li>
<li>
<p>Campo ModRB: El tercer byte vale <code>EC</code> &#8594; <code>1110-1100</code> hace referencia al registro RSP.</p>
<div class="ulist">
<ul>
<li>
<p>2.1.3 ModR/M and SIB Bytes: Many instructions that refer to an operand in memory (memoria principal o registro interno CPU) ha
ve an addressing-form specifier byte (called the ModR/M &#8230;&#8203;). Este campo se divide en subcampos: <strong>Mod-Reg/Opcode-R/M</strong></p>
</li>
<li>
<p>Subcampo Mod: <code>11</code> : The mod field combines with the r/m field to form 32 possible values: eight registers (rax, rbx, rcx, rdx, rsi, rdi, rsp, rbp) and 24 addressing modes</p>
</li>
<li>
<p>Subcampo Reg/Opcode: En este caso no es Secondary Opcode sino que es Reg: rrr= <code>101</code></p>
</li>
<li>
<p>Subcampo R/M: En este caso R: bbb= <code>100</code> The r/m field can specify a register as an operand or it can be combined with the mod field to encode an addressing mode. <strong>En este caso es el registro operando con código 4</strong>. En la tabla 3.1 el código del <strong>quad word register</strong> con el <strong>Reg Field</strong> de valor <strong>4</strong> es el registro <strong>RSP</strong></p>
</li>
<li>
<p>Figure 2-5. Register-Register Addressing (No Memory Operand); REX.X Not Used &#8594; Mod=11 &#8594; Rrrr =0101 &#8594; Bbbb=0100</p>
</li>
</ul>
</div>
</li>
<li>
<p>El cuarto byte vale en hexadecimal <code>10</code> que se corresponde con el valor inmediato 16 en decimal y debe ser expandido a 64bits.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_otros_x86_32">25.1.2. Otros x86-32</h4>
<div class="ulist">
<ul>
<li>
<p><a href="http://www.c-jump.com/CIS77/CPU/x86/lecture.html#X77_0010_real_encoding" class="bare">http://www.c-jump.com/CIS77/CPU/x86/lecture.html#X77_0010_real_encoding</a></p>
<div class="ulist">
<ul>
<li>
<p><code>ADD cl,al</code> &#8594; 02C8</p>
</li>
<li>
<p><code>ADD EAX, [ ESI + disp8 ]</code> &#8594; 0346XX</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="http://en.wikibooks.org/wiki/X86_Assembly/Control_Flow#Jump_Instructions">jump instructions</a></p>
</li>
<li>
<p>Hola mundo x86</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c">08048190 &lt;_start&gt;:
 8048190:	b8 04 00 00 00       	mov    $0x4,%eax
 8048195:	bb 01 00 00 00       	mov    $0x1,%ebx
 804819a:	b9 f4 9f 04 08       	mov    $0x8049ff4,%ecx
 804819f:	8b 15 ff 9f 04 08    	mov    0x8049fff,%edx
 80481a5:	cd 80                	int    $0x80
 80481a7:	b8 01 00 00 00       	mov    $0x1,%eax
 80481ac:	bb 00 00 00 00       	mov    $0x0,%ebx
 80481b1:	cd 80                	int    $0x80</code></pre>
</div>
</div>
</li>
<li>
<p><strong>b8 04 00 00 00</strong> &#8594; 	mov    $0x4,%eax</p>
<div class="ulist">
<ul>
<li>
<p>Manual: <em>B8 + rd  MOV reg32,imm32   2             Move immediate dword to register</em>:</p>
<div class="ulist">
<ul>
<li>
<p>Campo de Código de Operación: <strong>B8</strong></p>
</li>
<li>
<p>Campo de operando: double word: 32 bits: <strong>04 00 00 00</strong>  &#8594; little endian &#8594; es el dato 0x00000004</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph nav-footer">
<p>← Previous: <a href="_rtl_register_transfer_language.html">RTL Register Transfer Language</a> | ↑ Up: <a href="_viii_apéndices.html">VIII Apéndices</a> | ⌂ Home: <a href="eecc_book.html">Estructura de Computadores  (240306)</a> | Next: <a href="_fpu_x87.html">FPU x87</a> →</p>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-09-04 21:51:14 +0200
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>